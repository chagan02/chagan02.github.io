
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
 "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
		
		<title>HydroViewer Advanced</title>
		<link rel="stylesheet" href="http://js.arcgis.com/3.14/esri/css/esri.css">
		<link rel="stylesheet" href="http://js.arcgis.com/3.14/dijit/themes/claro/claro.css">
		<link rel='stylesheet' type='text/css' href='./HydroViewer.css' />
		<script src="./data/HydroViewerHTMLConfig.js"></script>
		<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
		<link rel="stylesheet" type="text/css" href="./src/agsjs/css/agsjs.css" />
		<script src="//code.jquery.com/jquery-1.10.2.js"></script>
		<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<!-- <script src="http://releases.flowplayer.org/js/flowplayer-3.2.13.min.js"></script> -->
		<audio id="BasinAlertAudio1" src="./sounds/BasinAlert1.wav" preload="auto"></audio>
		<audio id="BasinAlertAudio2" src="./sounds/BasinAlert2.wav" preload="auto"></audio>
		<audio id="RiverAlertAudio1" src="./sounds/RiverAlert1.wav" preload="auto"></audio>
		
		<script>
		//JS Script to set dojoConfig path
			var dojoConfig = {
				packages: [
					{
						name: "agsjs",
						location: location.pathname.replace(/\/[^/]+$/, "") + '/src/agsjs'
					}]
			};
		</script>
	
		<script src="http://js.arcgis.com/3.14/"></script>

        <script src="src/jquery.tablesorter.js"></script>
		<style>
			table.tablesorter thead tr th, table.tablesorter tfoot tr th {
				background-color: #99ffff;
				border: 2px solid #3300FF;
				border-radius: 5px;
				font-size: large;
			}
			table.tablesorter thead tr .headerSortDown, table.tablesorter thead tr .headerSortUp {
				background-color: yellow;
			}
		</style>


		<script>
		
		
		// Set Initial Config //
		var MainDir = './';
		var DataDir = MainDir + 'archive/working/';
		
		//Primary JS script for ESRI API Call	
	
			var dialog;
		  
		     require(["esri/map","esri/geometry/webMercatorUtils","esri/dijit/BasemapToggle","dojo/_base/connect","dijit/form/Button",
			 "dojo/dom","dojo/parser","dojo/ready","dojo/on", "dojo/_base/Color","dojo/keys", "dojo/_base/array","dojo/number","dijit/registry","dojo/json", "dojo/request/xhr",
			 "esri/config","esri/SnappingManager","esri/dijit/Measurement","esri/tasks/locator","esri/graphic","esri/layers/GraphicsLayer","esri/dijit/Popup",
			 "esri/dijit/PopupTemplate","esri/layers/WMSLayer","esri/layers/WMSLayerInfo","esri/urlUtils","esri/arcgis/utils","esri/geometry/Extent", 
			 "esri/layers/FeatureLayer","esri/layers/ImageParameters","esri/layers/CSVLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer", "esri/geometry/Point", "esri/SpatialReference",
			 "esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/symbols/TextSymbol","esri/symbols/Font","esri/tasks/GeometryService","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters",
			 "esri/tasks/query","dojo/dom-construct","dojo/dom-style","esri/renderers/SimpleRenderer","esri/layers/LabelLayer","esri/renderers/ClassBreaksRenderer",
			 "esri/InfoTemplate","esri/symbols/SimpleMarkerSymbol","esri/symbols/PictureMarkerSymbol","agsjs/dijit/TOC","dijit/layout/BorderContainer","dijit/layout/ContentPane",
			 "dijit/TitlePane","esri/dijit/Scalebar","esri/TimeExtent","esri/dijit/TimeSlider","esri/layers/TimeInfo","esri/layers/MapImageLayer","esri/layers/MapImage","esri/tasks/query", "esri/tasks/QueryTask","esri/request","dojo/_base/lang","dojo/query",
			 "dojo/date/locale","dojo/fx","dijit/TooltipDialog","dojo/domReady!"], function(Map, webMercatorUtils, BasemapToggle, connect, Button, dom, parser, ready, on, Color, keys, arrayUtils, number, registry, JSON, xhr, esriConfig, SnappingManager, Measurement,
			 Locator, Graphic, GraphicsLayer, Popup, PopupTemplate, WMSLayer, WMSLayerInfo, urlUtils, arcgisUtils, Extent, FeatureLayer, ImageParameters, CSVLayer, ArcGISTiledMapServiceLayer, ArcGISDynamicMapServiceLayer, Point, SpatialReference, 
			 SimpleLineSymbol, SimpleFillSymbol, UniqueValueRenderer, TextSymbol, Font, GeometryService, IdentifyTask, IdentifyParameters, Query, domConstruct, domStyle, SimpleRenderer, LabelLayer, ClassBreaksRenderer, InfoTemplate, 
			 SimpleMarkerSymbol, PictureMarkerSymbol, TOC, BorderContainer, ContentPane, TitlePane, Scalebar, TimeExtent, TimeSlider, TimeInfo, MapImageLayer, MapImage, Query, QueryTask, esriRequest, lang, locale, TooltipDialog, dijitPopup, query){
		  
			ready(function(){

			// parser.parse();

			//###############################################################################
			
			// Quick Zoom Build Buttons
			var adiv = dom.byId("mapcontrols");
			var html = adiv.innerHTML;
			var Keys = Object.keys(QuickZoomButton_Dict);
			for (var i = 0; i < Object.keys(QuickZoomButton_Dict).length; ++i) {
			    //console.log(Keys);
			    html += '<button id="' + Keys[i] + '" style="border:1px solid #3300FF;border-radius:5px;margin:3px;background:#99FFFF"> ' + Keys[i] + '</button>';
			}
			adiv.innerHTML = html;

			// Now bind the event handlers to them
			for (let i = 0; i < Object.keys(QuickZoomButton_Dict).length; ++i) {
			    var elem = document.getElementById(Keys[i]);
			    elem.addEventListener('click', function() {
				vals = QuickZoomButton_Dict[Keys[i]].split("/");
				setExtent(vals[0],vals[1],vals[2]);
				ChangeZoomButtons(Keys[i]);
			    });
			};
					
			
			//Checkboxes to be customized by office, Box 1 is left, Box 2 is right
			on(dom.byId("Precip-1"), "change", function(evt){changeMap(activeprecip1);changePrimaryLegend("Precip1","Ratio","PrimaryLegend1");});
			on(dom.byId("Precip-2"), "change", function(evt){changeMap(activeprecip2);changePrimaryLegend("Precip2","Ratio","PrimaryLegend2");});
			on(dom.byId("QPESOURCE-1"), "change", function(evt){updateLayerVisibility("QPESOURCE-1",[mil1]);LoadQPEImage(selectedlayer,BasinPlotSource);changeSecondaryLegend("QPESOURCE1","precipitation","SecondaryLegend1");});
			on(dom.byId("QPESOURCE-2"), "change", function(evt){updateLayerVisibility("QPESOURCE-2",[mil2]);LoadQPEImage(selectedlayer,BasinPlotSource);changeSecondaryLegend("QPESOURCE2","precipitation","SecondaryLegend2");});
			on(dom.byId("Basins-1"), "change", function(evt){GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);updateLayerVisibility("Basins-1",[SubBasins1]);changePrimaryLegend("Basins1",BasinPlotType,"PrimaryLegend1");});
			on(dom.byId("Basins-2"), "change", function(evt){GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);updateLayerVisibility("Basins-2",[SubBasins2]);changePrimaryLegend("Basins2",BasinPlotType,"PrimaryLegend2");});
			on(dom.byId("Rivers-1"), "change", function(evt){updateLayerVisibility("Rivers-1",[LatestRiverStages1,LatestRiverStagestextLayer1]);changePrimaryLegend("Rivers1","Rivers","PrimaryLegend1");});
			on(dom.byId("Rivers-2"), "change", function(evt){updateLayerVisibility("Rivers-2",[LatestRiverStages2,LatestRiverStagestextLayer2]);changePrimaryLegend("Rivers2","Rivers","PrimaryLegend2");});
			on(dom.byId("LatestTemperatures-1"), "change", function(evt){updateLayerVisibility("LatestTemperatures-1",[LatestTemperatures1,LatestTemperaturestextLayer1]);changePrimaryLegend("LatestTemperatures1","TemperatureLegendNew","PrimaryLegend1");});
			on(dom.byId("LatestTemperatures-2"), "change", function(evt){updateLayerVisibility("LatestTemperatures-2",[LatestTemperatures2,LatestTemperaturestextLayer2]);changePrimaryLegend("LatestTemperatures2","TemperatureLegendNew","PrimaryLegend2");});
			on(dom.byId("LatestWindGusts-1"), "change", function(evt){updateLayerVisibility("LatestWindGusts-1",[LatestWindGusts1,LatestWindGuststextLayer1]);changePrimaryLegend("LatestWindGusts1","WindLegendNew","PrimaryLegend1");});
			on(dom.byId("LatestWindGusts-2"), "change", function(evt){updateLayerVisibility("LatestWindGusts-2",[LatestWindGusts2,LatestWindGuststextLayer2]);changePrimaryLegend("LatestWindGusts2","WindLegendNew","PrimaryLegend2");});
			on(dom.byId("LatestWindChill-1"), "change", function(evt){updateLayerVisibility("LatestWindChill-1",[LatestWindChill1,LatestWindChilltextLayer1]);changePrimaryLegend("LatestWindChill1","WindChillLegendNew","PrimaryLegend1");});
			on(dom.byId("LatestWindChill-2"), "change", function(evt){updateLayerVisibility("LatestWindChill-2",[LatestWindChill2,LatestWindChilltextLayer2]);changePrimaryLegend("LatestWindChill2","WindChillLegendNew","PrimaryLegend2");});
			on(dom.byId("Radar-1"), "change", function(evt){updateLayerVisibility("Radar-1",[Radar_DMSLayer1]);});
			on(dom.byId("Radar-2"), "change", function(evt){updateLayerVisibility("Radar-2",[Radar_DMSLayer2]);});
			on(dom.byId("Warnings-1"), "change", function(evt){updateLayerVisibility("Warnings-1",[Warnings_DMSLayer1]);});
			on(dom.byId("Warnings-2"), "change", function(evt){updateLayerVisibility("Warnings-2",[Warnings_DMSLayer2]);});
			on(dom.byId("Watches-1"), "change", function(evt){updateLayerVisibility("Watches-1",[Watches_DMSLayer1]);});
			on(dom.byId("Watches-2"), "change", function(evt){updateLayerVisibility("Watches-2",[Watches_DMSLayer2]);});	
			on(dom.byId("NWSCWAs-1"), "change", function(evt){updateLayerVisibility("NWSCWAs-1",[NWSCWAs1]);});
			on(dom.byId("NWSCWAs-2"), "change", function(evt){updateLayerVisibility("NWSCWAs-2",[NWSCWAs2]);});		
			on(dom.byId("Roads-1"), "change", function(evt){updateLayerVisibility("Roads-1",[Roads_DMSLayer1]);});
			on(dom.byId("Roads-2"), "change", function(evt){updateLayerVisibility("Roads-2",[Roads_DMSLayer2]);});
			on(dom.byId("Spotters-1"), "change", function(evt){updateLayerVisibility("Spotters-1",[Spotters1]);});
			on(dom.byId("Spotters-2"), "change", function(evt){updateLayerVisibility("Spotters-2",[Spotters2]);});	
			on(dom.byId("fire-1"), "change", function(evt){updateLayerVisibility("fire-1",[fire1]);});
			on(dom.byId("fire-2"), "change", function(evt){updateLayerVisibility("fire-2",[fire2]);});	
			on(dom.byId("police-1"), "change", function(evt){updateLayerVisibility("police-1",[police1]);});
			on(dom.byId("police-2"), "change", function(evt){updateLayerVisibility("police-2",[police2]);});	
			on(dom.byId("postoffice-1"), "change", function(evt){updateLayerVisibility("postoffice-1",[postoffice1]);});
			on(dom.byId("postoffice-2"), "change", function(evt){updateLayerVisibility("postoffice-2",[postoffice2]);});
			on(dom.byId("schools-1"), "change", function(evt){updateLayerVisibility("schools-1",[schools1]);});
			on(dom.byId("schools-2"), "change", function(evt){updateLayerVisibility("schools-2",[schools2]);});
			on(dom.byId("OtherContacts-1"), "change", function(evt){updateLayerVisibility("OtherContacts-1",[OtherContacts1]);});
			on(dom.byId("OtherContacts-2"), "change", function(evt){updateLayerVisibility("OtherContacts-2",[OtherContacts2]);});	
			on(dom.byId("LSR-1"), "change", function(evt){updateLayerVisibility("LSR-1",[LSR_Layer1]);});
			on(dom.byId("LSR-2"), "change", function(evt){updateLayerVisibility("LSR-2",[LSR_Layer2]);});
			on(dom.byId("SpotForecast-1"), "change", function(evt){updateLayerVisibility("SpotForecast-1",[SpotForecast1]);});
			on(dom.byId("SpotForecast-2"), "change", function(evt){updateLayerVisibility("SpotForecast-2",[SpotForecast2]);});	
			on(dom.byId("RainObs-1"), "change", function(evt){updateLayerVisibility("RainObs-1",[RainObs1]);});
			on(dom.byId("RainObs-2"), "change", function(evt){updateLayerVisibility("RainObs-2",[RainObs2]);});
			on(dom.byId("FloodEvents-1"), "change", function(evt){updateLayerVisibility("FloodEvents-1",[FloodEvents1]);});
			on(dom.byId("FloodEvents-2"), "change", function(evt){updateLayerVisibility("FloodEvents-2",[FloodEvents2]);});
			on(dom.byId("NCLandSlides-1"), "change", function(evt){updateLayerVisibility("NCLandSlides-1",[NCLandSlides1]);});
			on(dom.byId("NCLandSlides-2"), "change", function(evt){updateLayerVisibility("NCLandSlides-2",[NCLandSlides2]);});			
			on(dom.byId("AutoFilter"), "change", function(evt){changeAutoFilterTrigger();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);});
			
			//Needed Lists that remain static for all offices
			ppintervalBtnList = ["30min","60min","120min","180min","360min","720min","1440min","1441min"];
			BasinTypeBtnList = ["Ratio","Diff","QPE"];
			BasinSourceBtnList = ["DPR","DHR","HPE","BHPE","MRMS","TopPerformer","WorstCase","BestCase","AllBlend","SmartBlend"];						
			
			var popup1 = new Popup({fillSymbol: new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID,new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,
            new Color([255, 0, 0]), 2), new Color([255, 255, 0, 0.25]))}, domConstruct.create("div"));
			
			var popup2 = new Popup({fillSymbol: new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID,new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,
            new Color([255, 0, 0]), 2), new Color([255, 255, 0, 0.25]))}, domConstruct.create("div"));
			
			//Set Symbol Colors
			var Black = new Color([0, 0, 0, 1.0]);
			var Red = new Color([255, 0, 0, 1.0]);
			var Yellow = new Color([255, 255, 0, 1.0]);
			var Green = new Color([0, 255, 0, 1.0]);
			var Orange = new Color([255, 140, 0, 1.0]);
			var Magenta = new Color([255, 29, 223, 1.0]);
			var White = new Color([255, 255, 255, 1.0]);
			var DarkGreen = new Color("#003300");
			var BrightGreen = new Color([101, 255, 101, 1.0]);
			var Cyan = new Color([88, 238, 254, 1.0]);
			var BrightBlue = new Color("#0000FF");
			var Aqua = new Color("#00FFCC");
			
			//Create SimpleFillSymbols
			var sfs = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color([0,0,0,0.1]), 0);	
			
			var sfsRed = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color([255,0,0,1.0]), 0);	
			
			var sfsYellow = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color([255, 255, 0, 1.0]), 0);	
			
			var sfsGreen = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color([0, 255, 0, 1.0]), 0);		

			var sfsOrange = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color([255, 140, 0, 1.0]), 0);	

			var sfsAqua = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color("#00FFCC"), 0);				
			
			var sfsWhite = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color([255,255,255,1.0]), 0);	

			var sfsBlack = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1),new esri.Color([0,0,0,1.0]), 0);	
			
			var sfsHollow = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 2.5),new esri.Color([0,0,0,0]), 0);

			var sfsHollowLight = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 1.5),new esri.Color([0,0,0,0]), 0);						
			
			// var popup = new Popup({fillSymbol: new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID,new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,
            // new Color([255, 0, 0]), 2), new Color([255, 255, 0, 0.25]))}, domConstruct.create("div"));
			
			
			//Ratio-Diff Color Definitions
			var Hollow = new Color([0,0,0,0]);
			var sfsClear0 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Hollow, 0);	
			
			var Cyan0 = new Color([229,255,255,1.0]);
			var sfsCyan0 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Cyan0, 0);				

			var Cyan1 = new Color([0,255,255,1.0]);
			var sfsCyan1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Cyan1, 0);	
			
			var Cyan2 = new Color([0,191,255,1.0]);
			var sfsCyan2 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Cyan2, 0);	
			
			var Blue1 = new Color([0,0,255,1.0]);
			var sfsBlue1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Blue1, 0);	
			
			var Green1 = new Color([0,255,0,1.0]);
			var sfsGreen1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Green1, 0);	
			
			var Green2 = new Color([0,177,0,1.0]);
			var sfsGreen2 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Green2, 0);	
			
			var Green3 = new Color([0,100,0,1.0]);
			var sfsGreen3 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Green3, 0);

			var Yellow1 = new Color([255,255,0,1.0]);
			var sfsYellow1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Yellow1, 0);

			var Orange1 = new Color([255,191,0,1.0]);
			var sfsOrange1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Orange1, 0);	

			var Orange2 = new Color([255,140,0,1.0]);
			var sfsOrange2 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Orange2, 0);		

			var Red1 = new Color([255,0,0,1.0]);
			var sfsRed1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Red1, 0);	

			var Red2 = new Color([204,0,0,1.0]);
			var sfsRed2 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Red2, 0);	

			var Red3 = new Color([165,50,50,1.0]);
			var sfsRed3 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Red3, 0);	

			var Pink1 = new Color([255,20,147,1.0]);
			var sfsPink1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Pink1, 0);	

			var Purple1 = new Color([132,112,255,1.0]);
			var sfsPurple1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),Purple1, 0);

			var White1 = new Color([255,255,255,1.0]);
			var sfsWhite1 = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
			new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
			new esri.Color([0,0,0]), 0.5),White1, 0);	
			
			//Initialize map
			var HomeExtent = new Extent({xmin:Xmin,ymin:Ymin,xmax:Xmax,ymax:Ymax,spatialReference:{wkid:4326}})
			map1 = new Map("map1", {basemap: "topo",slider:false,extent:HomeExtent,infoWindow: popup1});
			map2 = new Map("map2", {basemap: "topo",slider:false,extent:HomeExtent,infoWindow: popup2});
			
			//Initialize Toggle widget
			var toggle1 = new BasemapToggle({map: map1,basemap: "hybrid"}, "BasemapToggle1");
			toggle1.startup();
			var toggle2 = new BasemapToggle({map: map2,basemap: "hybrid"}, "BasemapToggle2");
			toggle2.startup();
			
			// APPLICAITON VARIABLES
			var _maps = [map1,map2];
			var _mapExtentChangeEvent;	
			
			// SYNC OPTIONS
			var _syncScale = true;
			var _syncLocation = true;	
	
			//Create Show Coordinates Function
			map1.on("load", function() {
			  //after map loads, connect to listen to mouse move & drag events
			  map1.on("mouse-move", showCoordinates1);
			  map1.on("mouse-drag", showCoordinates1);
			});
			
			//Create Show Coordinates Function
			map2.on("load", function() {
			  //after map loads, connect to listen to mouse move & drag events
			  map2.on("mouse-move", showCoordinates2);
			  map2.on("mouse-drag", showCoordinates2);
			});
			
			function showCoordinates1(evt) {
			  var mp = webMercatorUtils.webMercatorToGeographic(evt.mapPoint);
			  document.getElementById('LatLon1').textContent = mp.y.toFixed(3) + ", " + mp.x.toFixed(3);
			};
			
			function showCoordinates2(evt) {
			  var mp = webMercatorUtils.webMercatorToGeographic(evt.mapPoint);
			  document.getElementById('LatLon2').textContent = mp.y.toFixed(3) + ", " + mp.x.toFixed(3);
			};
			
			 // CONNECT ONMOUSEOVER EVENT
			 dojo.connect(map1, 'onMouseOver', function (evt) {
			 });
				dojo.connect(map1,"onDblClick",function(evt){
				  connectEvents(map1);
				 } );

			 dojo.connect(map1, "onMouseWheel", function (evt) {
			 // CONNECT ONEXTENTCHANGE EVENT
			 connectEvents(map1);
			 });
			 dojo.connect(map1, "onMouseDragStart", function (evt) {
			 // CONNECT ONEXTENTCHANGE EVENT
			 connectEvents(map1);
			 });
			 
			// CONNECT ONMOUSEOVER EVENT
			 dojo.connect(map2, 'onMouseOver', function (evt) {
			 });
				dojo.connect(map2,"onDblClick",function(evt){
				  connectEvents(map2);
				 } );

			 dojo.connect(map2, "onMouseWheel", function (evt) {
			 // CONNECT ONEXTENTCHANGE EVENT
			 connectEvents(map2);
			 });
			 dojo.connect(map2, "onMouseDragStart", function (evt) {
			 // CONNECT ONEXTENTCHANGE EVENT
			 connectEvents(map2);
			 });
			 

			// DISCONNECT ONEXTENTCHANGE EVENT
			function disconnectEvents() {
			if (_mapExtentChangeEvent) {
			  dojo.disconnect(_mapExtentChangeEvent);
			};
			};

			// CONNECT ONEXTENTCHANGE EVENT
			function connectEvents(map) {
			disconnectEvents();
			_mapExtentChangeEvent = dojo.connect(map, 'onExtentChange', function (extent, delta, levelChange, lod) {
			  if (_syncScale && levelChange) {
				// SYNC SCALES
				syncMapScales(map);
			  } else {
				if (_syncLocation) {
				  // SYNC LOCATION
				  syncMapLocations(map);
				};
			  };
			  // DISCONNECT ONEXTENTCHANGE EVENT
			  disconnectEvents();
			});
			};
			
			// IS THE SPATIAL REFERNECE WEB MERCATOR
			function isWebMercator(spatialReference) {
			return (dojo.indexOf([3857, 102100, 102113], spatialReference.wkid) > -1);
			};
			
			// GET CENTER OF OTHER MAP BASED ON THIS MAP
			function getCenter(thisMap, otherMap, callback) {
			if (thisMap.spatialReference.wkid === otherMap.spatialReference.wkid) {
			  if (callback) {
				callback(thisMap.extent.getCenter());
			  }
			} else if (isWebMercator(thisMap.spatialReference) && isWebMercator(otherMap.spatialReference)) {
			  if (callback) {
				callback(thisMap.extent.getCenter());
			  }
			} else {
			  var geomSrv = new esri.tasks.GeometryService(userConfig.geometryServiceURL);
			  geomSrv.project([thisMap.extent.getCenter()], otherMap.spatialReference, function (projectedGeoms) {
				if (callback) {
				  callback(projectedGeoms[0]);
				}
			  });
			};
			};
			
			// SYNC MAP SCALES
			function syncMapScales(thisMap) {
			var thisMapScale = getMapScale(thisMap);
			dojo.forEach(_maps, function (otherMap) {
			  if (otherMap.id !== thisMap.id) {
				var otherMapLevel = getMapLevelByScale(otherMap, thisMapScale);
				if (otherMapLevel) {
				  if (_syncLocation) {
					getCenter(thisMap, otherMap, function (otherCenter) {
					  otherMap.centerAndZoom(otherCenter, otherMapLevel);
					});
				  } else {
					otherMap.setLevel(otherMapLevel);
				  }
				}
			  }
			});
			};
			
			// SYNC MAP LOCATIONS
			function syncMapLocations(thisMap) {
			dojo.forEach(_maps, function (otherMap) {
			  if (otherMap.id !== thisMap.id) {
				getCenter(thisMap, otherMap, function (otherCenter) {
				  otherMap.centerAt(otherCenter);
				});
			  }
			});
			};
			
			// GET MAP LEVEL BASED ON SCALE
			function getMapLevelByScale(map, mapScale) {
			var nearLODs = dojo.filter(map.__tileInfo.lods, function (lod) {
			  return (parseInt(lod.scale, 10) <= parseInt(mapScale, 10));
			});
			if (nearLODs.length > 0) {
			  return nearLODs[0].level;
			} else {
			  return null;
			};
			};
			
			// GET MAP SCALE
			function getMapScale(map) {
			return esri.geometry.getScale(map);
			};
			
			//Define Change Zoom Function
			function ChangeZoomButtons(SelectedButton) {
			for (i = 0; i < Object.keys(QuickZoomButton_Dict).length; i++) {
			var currentZoomBtn = Keys[i];
				if (SelectedButton == currentZoomBtn) {
					document.getElementById(SelectedButton).style.backgroundColor = "yellow";
				} else {
					document.getElementById(currentZoomBtn).style.backgroundColor = "#99FFFF";
				};
				};
			};
			
			//Define Set Extent Function
			function setExtent(lon,lat,zoom) {
				var pt = esri.geometry.geographicToWebMercator(new esri.geometry.Point(lon, lat));
				map1.centerAndZoom(pt, zoom);
				map2.centerAndZoom(pt, zoom);
				};
			
			function ChangeIntervalButtons(SelectedButton) {
			for (i = 0; i < ppintervalBtnList.length; i++) {
			var currentintervalBtn = ppintervalBtnList[i];
				if (SelectedButton == currentintervalBtn) {
					document.getElementById(SelectedButton).style.backgroundColor = "yellow";
					activeprecip1 = SelectedButton;
					activeprecip2 = SelectedButton;
				} else {
					document.getElementById(currentintervalBtn).style.backgroundColor = "#99FFFF";};
				};	
			};
			
			function ChangeBasinTypeButtons(SelectedButton) {
			for (i = 0; i < BasinTypeBtnList.length; i++) {
			var currentBtn = BasinTypeBtnList[i];
				if (SelectedButton == currentBtn) {
					document.getElementById(SelectedButton).style.backgroundColor = "yellow";
				} else {
					document.getElementById(currentBtn).style.backgroundColor = "#99FFFF";};
				};	
			};
			
			function ChangeBasinSourceButtons(SelectedButton,OverallTopPerformer,OverallBottomPerformer) {
			console.log("OverallTopPerformer: " + OverallTopPerformer);
			for (i = 0; i < BasinSourceBtnList.length; i++) {
			var currentBtn = BasinSourceBtnList[i];
				if (SelectedButton == currentBtn) {
					document.getElementById(SelectedButton).style.backgroundColor = "yellow";
				} else {
					document.getElementById(currentBtn).style.backgroundColor = "#99FFFF";};
				};	
				
			if (SelectedButton == "TopPerformer"){
			if (OverallTopPerformer != "None"){
			document.getElementById(OverallBottomPerformer).style.backgroundColor = "#ff0000";
			document.getElementById(OverallTopPerformer).style.backgroundColor = "#00ff00";
			} else {
			document.getElementById("DHR").style.backgroundColor = "#ff0000";
			document.getElementById("DPR").style.backgroundColor = "#ff0000";
			document.getElementById("HPE").style.backgroundColor = "#ff0000";
			document.getElementById("BHPE").style.backgroundColor = "#ff0000";
			document.getElementById("MRMS").style.backgroundColor = "#ff0000";
			};
			};
			
			if (SelectedButton == "SmartBlend"){
			if (OverallTopPerformer != "None"){
			document.getElementById(SelectedButton).style.backgroundColor = "yellow";
			} else {
			document.getElementById("DHR").style.backgroundColor = "#ff0000";
			document.getElementById("DPR").style.backgroundColor = "#ff0000";
			document.getElementById("HPE").style.backgroundColor = "#ff0000";
			document.getElementById("BHPE").style.backgroundColor = "#ff0000";
			document.getElementById("MRMS").style.backgroundColor = "#ff0000";
			};
			};
			};


			function changePrimaryLegendButton(imgName) {
			var box1 = document.getElementById("Basins1");
			var box2 = document.getElementById("Basins2");
			//console.log("IMAGE NAME: " + imgName);
			if (box1.checked == true && box2.checked == true) {
			document.getElementById('PrimaryLegend1').innerHTML="<img src='" + MainDir + "images/legends/"+imgName+".png'/>";
			document.getElementById('PrimaryLegend1').style.visibility= 'visible';
			document.getElementById('PrimaryLegend2').innerHTML="<img src='" + MainDir + "images/legends/"+imgName+".png'/>";
			document.getElementById('PrimaryLegend2').style.visibility= 'visible';
			} else {
			if (box1.checked == true){
			document.getElementById('PrimaryLegend1').innerHTML="<img src='" + MainDir + "images/legends/"+imgName+".png'/>";
			document.getElementById('PrimaryLegend1').style.visibility= 'visible';
			};
			if (box2.checked == true){
			document.getElementById('PrimaryLegend2').innerHTML="<img src='" + MainDir + "images/legends/"+imgName+".png'/>";
			document.getElementById('PrimaryLegend2').style.visibility= 'visible';
			};
			};
			};
				
			//Precip interval and Type Buttons
			var intervalBtn1 = {id: "30min",onClick: function (evt) {ResetSlider2(),changeMap("30min"),ChangeIntervalButtons("30min");}};
			var intervalBtn2 = {id: "60min",onClick: function (evt) {ResetSlider2(),changeMap("60min"),ChangeIntervalButtons("60min");}};
			var intervalBtn3 = {id: "120min",onClick: function (evt) {ResetSlider2(),changeMap("120min"),ChangeIntervalButtons("120min");}};
			var intervalBtn4 = {id: "180min",onClick: function (evt) {ResetSlider2(),changeMap("180min"),ChangeIntervalButtons("180min");}};
			var intervalBtn5 = {id: "360min",onClick: function (evt) {ResetSlider2(),changeMap("360min"),ChangeIntervalButtons("360min");}};
			var intervalBtn7 = {id: "720min",onClick: function (evt) {ResetSlider2(),changeMap("720min"),ChangeIntervalButtons("720min");}};
			var intervalBtn11 = {id: "1440min",onClick: function (evt) {ResetSlider2(),changeMap("1440min"),ChangeIntervalButtons("1440min");}};
			var intervalBtn12 = {id: "1441min",onClick: function (evt) {ResetSlider2(),changeMap("1441min"),ChangeIntervalButtons("1441min");}};
			var intervalBtn8 = {id: "Ratio",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,"Ratio",BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE),ChangeBasinTypeButtons("Ratio");changePrimaryLegendButton("Ratio");}};
			var intervalBtn9 = {id: "Diff",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,"Diff",BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE),ChangeBasinTypeButtons("Diff");changePrimaryLegendButton("Diff");}};
			var intervalBtn10 = {id: "QPE",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,"QPE",BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE),ChangeBasinTypeButtons("QPE");changePrimaryLegendButton("QPE");}};
			dojo.query("#30min").connect("onclick", intervalBtn1.onClick);
			dojo.query("#60min").connect("onclick", intervalBtn2.onClick);
			dojo.query("#120min").connect("onclick", intervalBtn3.onClick);
			dojo.query("#180min").connect("onclick", intervalBtn4.onClick);
			dojo.query("#360min").connect("onclick", intervalBtn5.onClick);
			dojo.query("#360min").connect("onclick", intervalBtn5.onClick);
			dojo.query("#720min").connect("onclick", intervalBtn7.onClick);
			dojo.query("#1440min").connect("onclick", intervalBtn11.onClick);
			dojo.query("#1441min").connect("onclick", intervalBtn12.onClick);
			dojo.query("#Ratio").connect("onclick", intervalBtn8.onClick);
			dojo.query("#Diff").connect("onclick", intervalBtn9.onClick);
			dojo.query("#QPE").connect("onclick", intervalBtn10.onClick);
			
			//QPE Source Buttons
			var SourceBtn1 = {id: "DPR",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"DPR",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn2 = {id: "DHR",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"DHR",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn3 = {id: "BHPE",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"BHPE",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn4 = {id: "HPE",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"HPE",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn5 = {id: "MRMS",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn6 = {id: "TopPerformer",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"TopPerformer",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn7 = {id: "WorstCase",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"WorstCase",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn8 = {id: "BestCase",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"BestCase",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn9 = {id: "AllBlend",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"AllBlend",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			var SourceBtn10 = {id: "SmartBlend",onClick: function (evt) {ResetSlider2(),GetTopPerformer(selectedlayer,BasinPlotType,"SmartBlend",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);}};
			dojo.query("#DPR").connect("onclick", SourceBtn1.onClick);
			dojo.query("#DHR").connect("onclick", SourceBtn2.onClick);
			dojo.query("#BHPE").connect("onclick", SourceBtn3.onClick);
			dojo.query("#HPE").connect("onclick", SourceBtn4.onClick);
			dojo.query("#MRMS").connect("onclick", SourceBtn5.onClick);
			dojo.query("#TopPerformer").connect("onclick", SourceBtn6.onClick);
			dojo.query("#WorstCase").connect("onclick", SourceBtn7.onClick);
			dojo.query("#BestCase").connect("onclick", SourceBtn8.onClick);
			dojo.query("#AllBlend").connect("onclick", SourceBtn9.onClick);
			dojo.query("#SmartBlend").connect("onclick", SourceBtn10.onClick);
			
			
			//Set Hover Text for Precip interval and Source Buttons
			$("#30min").attr('title', 'Data computed over the last 30 Minutes');
			$("#60min").attr('title', 'Data computed over the last 1 Hour');
			$("#120min").attr('title', 'Data computed over the last 2 Hours');
			$("#180min").attr('title', 'Data computed over the last 3 Hours');
			$("#360min").attr('title', 'Data computed over the last 6 Hours');
			$("#720min").attr('title', 'Data computed over the last 12 Hours');
			$("#1440min").attr('title', 'Data computed over the last 24 Hours');
			$("#1441min").attr('title', 'Data computed from 12z yesterday to 12z today');
			$("#TopPerformer").attr('title', 'Best Performing ONE Source');
			$("#WorstCase").attr('title', 'Highest QPE of all sources');
			$("#BestCase").attr('title', 'Lowest QPE of all sources');
			$("#AllBlend").attr('title', 'Equal blend of all sources');
			
			//Function to set SmartBlend attribute hover text
			function setSmartBlendAttributes(SmartBlendAttributes){$("#SmartBlend").attr('title', SmartBlendAttributes);};
			
			//Geo Locator Code
			locator = new Locator("http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer");
			locator.on("address-to-locations-complete", showResultsLoc);
			
			// listen for button click then geocode
			var LocateBtn = {id: "locate",onClick: function (evt) {locate();}};
			dojo.query("#locate").connect("onclick", LocateBtn.onClick);
			var ClearLocateBtn = {id: "clearlocate",onClick: function (evt) {clearlocate();}};
			dojo.query("#clearlocate").connect("onclick", ClearLocateBtn.onClick);
			dom.byId("address").value = 'Enter Address';
			dom.byId("lat").value = 'Enter Lat';
			dom.byId("lon").value = 'Enter Long';
			
			function clearlocate(){
			dom.byId("address").value = '';
			dom.byId("lat").value = '';
			dom.byId("lon").value = '';
			map1.graphics.clear();
			map2.graphics.clear();
			};

			function locate() {
			  // alerttrigger = false;
			  map1.graphics.clear();
			  map2.graphics.clear();
			  
			  addressval = dom.byId("address").value;
			  latval = dom.byId("lat").value;
			  lonval = dom.byId("lon").value;
			  
			  if (addressval == "Enter Address") {
			  var addressval = "";
			  };
			  if (latval == "Enter Lat") {
			  var latval = "";
			  };
			  if (lonval == "Enter Long") {
			  var lonval = "";
			  };
			  
			  var address = {"SingleLine": addressval + " " + lonval + " " + latval};
			  
			  locator.outSpatialReference = map1.spatialReference;
			  var options = {
				address: address,
				outFields: ["Loc_name"]
			  };
			  locator.addressToLocations(options);
			  // };
			};

			function showResultsLoc(evt) {
			  var candidate;
			  var symbol = new SimpleMarkerSymbol();
			  var infoTemplate = new InfoTemplate(
				"Location", 
				"Address: ${address}<br />Score: ${score}<br />Source locator: ${locatorName}"
			  );
			  symbol.setStyle(SimpleMarkerSymbol.STYLE_CIRCLE);
			  symbol.setColor(new Color([153,0,51,0.75]));

			  var geom;
			  arrayUtils.every(evt.addresses, function(candidate) {
				if (candidate.score > 80) {
				  var attributes = { 
					address: candidate.address, 
					score: candidate.score, 
					locatorName: candidate.attributes.Loc_name 
				  };   
				  geom = candidate.location;
				  var graphic1 = new Graphic(geom, symbol, attributes, infoTemplate);
				  var graphic2 = new Graphic(geom, symbol, attributes, infoTemplate);
				  map1.graphics.add(graphic1); 
				  map2.graphics.add(graphic2);
				  
				  //add a text symbol to the map listing the location of the matched address.
				  var displayText = candidate.address;
				  var font = new Font(
					"16pt",
					Font.STYLE_NORMAL, 
					Font.VARIANT_NORMAL,
					Font.WEIGHT_BOLD,
					"Helvetica"
				  );
				 
				  var textSymbol = new TextSymbol(
					displayText,
					font,
					new Color("#000000")
				  );
				  textSymbol.setOffset(0,15);
				  map1.graphics.add(new Graphic(geom, textSymbol));
				  map2.graphics.add(new Graphic(geom, textSymbol));
				  return false; //break out of loop after one candidate with score greater  than 80 is found.
				} else {alert("Please Check Your Search Criteria");};
			  });
			  if ( geom !== undefined ) {
				map1.centerAndZoom(geom, 15);
				map2.centerAndZoom(geom, 15);
			  };
			};
			
			//Assign Ratio/StageCat Plot Colors Function
			function ratioColor(RatioAlt) {
			if (isNaN(RatioAlt)) {
				if (RatioAlt === 'Normal') {color = Black;FontSize = '14';HaloColor = White;};
				if (RatioAlt === 'Action') {color = Yellow;FontSize = '28';HaloColor = Black;};
				if (RatioAlt === 'Minor') {color = Orange;FontSize = '24';HaloColor = Black;};
				if (RatioAlt === 'Moderate') {color = Red;FontSize = '20';HaloColor = Black;};
				if (RatioAlt === 'Major') {color = Magenta;FontSize = '18';HaloColor = Black;};
				} else {
				if (RatioAlt < 70) {color = Black;FontSize = '14';HaloColor = White;};
				if (RatioAlt >= 70 && RatioAlt < 75) {color = Orange1;FontSize = '16';HaloColor = Black;};
				if (RatioAlt >= 75 && RatioAlt < 80) {color = Orange2;FontSize = '16';HaloColor = Black;};
				if (RatioAlt >= 80 && RatioAlt < 85) {color = Red1;FontSize = '16';HaloColor = Black;};
				if (RatioAlt >= 85 && RatioAlt < 90) {color = Red2;FontSize = '16';HaloColor = Black;};
				if (RatioAlt >= 90 && RatioAlt < 95) {color = Red3;FontSize = '20';HaloColor = Black;};
				if (RatioAlt >= 95 && RatioAlt < 100) {color = Pink1;FontSize = '20';HaloColor = Black;};
				if (RatioAlt >= 100 && RatioAlt < 200) {color = Purple1;FontSize = '24';HaloColor = Black;};
				if (RatioAlt >= 200) {color = White1;FontSize = '26';HaloColor = Black;};
				if (RatioAlt == 9999) {color = Black;FontSize = '14';HaloColor = White;};
				};
			return [color,FontSize,HaloColor];
			};
			
			//Assign WindGust Plot Colors Function	
			function WindColor(WValue,GValue) {	
				//Normal Level
				if (WValue < 15 && GValue < 25) {color = Black;FontSize = '14';HaloColor = White;};
				//Fire Danger Level
				if (WValue >= 15 && WValue < 18) {color = Yellow;FontSize = '14';HaloColor = Black;};
				//Red Flag
				if (WValue >= 18 && WValue < 26) {color = Red;FontSize = '14';HaloColor = Black;};
				//Advisory Level
				if (WValue >= 26 && WValue < 40 || GValue >= 40 && GValue < 58) {color = Cyan;FontSize = '14';HaloColor = Black;};
				//Warning Level
				if (WValue >= 40 || GValue >= 58) {color = Magenta;FontSize = '14';HaloColor = Black;};
				//Missing Data
				if (WValue == 9999 || GValue == 9999) {color = Black;FontSize = '14';HaloColor = White;};
			return [color,FontSize,HaloColor];
			};
			
			//Assign WindChill Plot Colors Function	
			function WCColor(WCValue) {
				// console.log(WCValue);
				// Normal Level
				if (WCValue > 10) {color = Black;FontSize = '14';HaloColor = White;};
				//Caution Level
				if (WCValue <= 10) {color = Yellow;FontSize = '16';HaloColor = Black;};
				//Advisory Level
				if (WCValue <= -5) {color = Cyan;FontSize = '18';HaloColor = Black;};
				//Warning Level
				if (WCValue <= -15) {color = Magenta;FontSize = '20';HaloColor = Black;};
				//Missing Data
				if (WCValue == 9999) {color = Black;FontSize = '14';HaloColor = White;}	;
				// console.log(color,FontSize,HaloColor);
			return [color,FontSize,HaloColor];
			};
			
		//Add All Layers
			// Add Feature Services	
			var CWACounties1 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/arcgis/rest/services/GSP/FeatureServer/0", {"visible":true, opacity:0.5});
			var CWACounties2 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/arcgis/rest/services/GSP/FeatureServer/0", {"visible":true, opacity:0.5});
			var renderer = new SimpleRenderer(sfsHollowLight);
			CWACounties1.setDefinitionExpression("CWA=" + "'" + CWA + "'");
			CWACounties2.setDefinitionExpression("CWA=" + "'" + CWA + "'");
			CWACounties1.setRenderer(renderer);
			CWACounties2.setRenderer(renderer);
			map1.addLayer(CWACounties1);	
			map2.addLayer(CWACounties2);	
			
			var NWSCWAs1 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/arcgis/rest/services/NWSCWAs/FeatureServer/0", {"visible":false, opacity:1.0});
			var NWSCWAs2 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/arcgis/rest/services/NWSCWAs/FeatureServer/0", {"visible":false, opacity:1.0});
			var renderer = new SimpleRenderer(sfsHollowLight);
			NWSCWAs1.setRenderer(renderer);
			NWSCWAs2.setRenderer(renderer);
			map1.addLayer(NWSCWAs1);	
			map2.addLayer(NWSCWAs2);	
			
			var SubBasinstemplate = new InfoTemplate();
			SubBasinstemplate.setContent(getBasinsTextContent);
			SubBasinstemplate.setTitle('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Basin Information</p>');
			var SubBasins1 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/ArcGIS/rest/services/" + CWA + "SubBasins/FeatureServer/0", {"visible":false, opacity:0.7, mode: FeatureLayer.MODE_ONDEMAND, outFields: ["*"],infoTemplate: SubBasinstemplate});
			var SubBasins2 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/ArcGIS/rest/services/" + CWA + "SubBasins/FeatureServer/0", {"visible":false, opacity:0.7, mode: FeatureLayer.MODE_ONDEMAND, outFields: ["*"],infoTemplate: SubBasinstemplate});
			defaultSymbol = new SimpleFillSymbol().setStyle(SimpleFillSymbol.STYLE_NULL);
			defaultSymbol.outline.setStyle(SimpleLineSymbol.STYLE_NULL);
			Basinrenderer = new UniqueValueRenderer(defaultSymbol, "PFAF_ID");			
			SubBasins1.setRenderer(Basinrenderer);
			SubBasins2.setRenderer(Basinrenderer);
			map1.addLayer(SubBasins1);
			map2.addLayer(SubBasins2);
			
			function getBasinsTextContent (graphic) {
			// setTimeout(function(){map.infoWindow.hide()}, 10000);
			var attributes = graphic.attributes;
			// map1.infoWindow.resize(200,200);
			// map2.infoWindow.resize(200,200);
            var attributes = graphic.attributes;
			var basinid = attributes.PFAF_ID;
			var name = "Name: " + attributes.STREAMNAME;
			var substring = basintable[basinid].split(":");
			var sub88D = "DHR/DPR Source: " + substring[6];
			var subWORST = "Worst Case Source: " + substring[5];
			var subBEST = "Best Case Source: " + substring[4];
			var subFFG = "FFG Value: " + substring[3] + '"';
			var subQPE = "QPE Value: " + substring[2] + '"';
			var subdiff = "FFG Diff: " + substring[1] + '"';
			var subratio = "FFG Ratio: " + substring[0] + '%';
			return name + "</b><br />" + subratio + "</b><br />" + subdiff + "</b><br />" + subQPE + "</b><br />" + subFFG + "</b><br />" + subBEST + "</b><br />" + subWORST + "</b><br />" + sub88D;
			};
			
			var CWAOutline1 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/arcgis/rest/services/NWSCWAs/FeatureServer/0", {"visible":true, opacity:1.0});
			var CWAOutline2 = new FeatureLayer("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/arcgis/rest/services/NWSCWAs/FeatureServer/0", {"visible":true, opacity:1.0});
			var renderer = new SimpleRenderer(sfsHollow);
			CWAOutline1.setDefinitionExpression("CWA=" + "'" + CWA + "'");
			CWAOutline2.setDefinitionExpression("CWA=" + "'" + CWA + "'");
			CWAOutline1.setRenderer(renderer);
			CWAOutline2.setRenderer(renderer);
			map1.addLayer(CWAOutline1);	
			map2.addLayer(CWAOutline2);	
			
			
			var LSRtemplate = new InfoTemplate();
			LSRtemplate.setContent(getLSRTextContent);
			LSRtemplate.setTitle('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Local Storm Report Attributes</p>');
			var LSR_Layer1 = new FeatureLayer("https://services1.arcgis.com/2iUE8l8JKrP2tygQ/ArcGIS/rest/services/NWS_LSRs_24_Hour_View/FeatureServer/0", {"visible":true, opacity:1.0, outFields: ["*"],infoTemplate: LSRtemplate});
			var LSR_Layer2 = new FeatureLayer("https://services1.arcgis.com/2iUE8l8JKrP2tygQ/ArcGIS/rest/services/NWS_LSRs_24_Hour_View/FeatureServer/0", {"visible":false, opacity:1.0, outFields: ["*"],infoTemplate: LSRtemplate});
			var renderer = new SimpleRenderer(sfsHollow);
			map1.addLayer(LSR_Layer1);	
			map2.addLayer(LSR_Layer2);	

			function getLSRTextContent (graphic) {
			// setTimeout(function(){map.infoWindow.hide()}, 10000);
			var attributes = graphic.attributes;
			// map1.infoWindow.resize(200,200);
			// map2.infoWindow.resize(200,200);
            var attributes = graphic.attributes;
			var validtime = attributes.VALID;
			var formattedtime = "Time: " + validtime.substring(4, 6) + '/' + validtime.substring(6, 8) + '/' + validtime.substring(0, 4) + ' ' + validtime.substring(8, 12) + " UTC";
			var typetext = "Type: " + attributes.TYPETEXT;
			var magnitude = "Magnitude: " + attributes.MAG;
			var city = "City: " + attributes.CITY;
			var county = "County: " + attributes.COUNTY;
			var state = "State: " + attributes.STATE;
			var source = "Source: " + attributes.SOURCE;
			var remark = "Remarks: " + attributes.REMARK;
			var latlong = "Lat/Long: " + attributes.LAT + '/' + attributes.LON;
			return formattedtime + "</b><br />" + typetext + "</b><br />" + magnitude + "</b><br />" + city + "</b><br />" + county + "</b><br />" + state + "</b><br />" + source + "</b><br />" + remark;
			};
				
			
			//Add Dynamic Service Layers
			var warningsImgParams = new ImageParameters();
			warningsImgParams.layerIds = [1,3,4];
			warningsImgParams.layerOption = ImageParameters.LAYER_OPTION_SHOW;
			var Warnings_DMSLayer1 = new ArcGISDynamicMapServiceLayer("http://new.nowcoast.noaa.gov/arcgis/rest/services/nowcoast/wwa_meteoceanhydro_shortduration_hazards_warnings_time/MapServer", {"visible":false, opacity:1.0,refreshInterval:1.0,"imageParameters": warningsImgParams});
			var Warnings_DMSLayer2 = new ArcGISDynamicMapServiceLayer("http://new.nowcoast.noaa.gov/arcgis/rest/services/nowcoast/wwa_meteoceanhydro_shortduration_hazards_warnings_time/MapServer", {"visible":false, opacity:1.0,refreshInterval:1.0,"imageParameters": warningsImgParams});
			map1.addLayer(Warnings_DMSLayer1);		
			map2.addLayer(Warnings_DMSLayer2);	

			var Watches_DMSLayer1 = new ArcGISDynamicMapServiceLayer("http://new.nowcoast.noaa.gov/arcgis/rest/services/nowcoast/wwa_meteoceanhydro_shortduration_hazards_watches_time/MapServer", {"visible":false, opacity:1.0,refreshInterval:10.0});
			var Watches_DMSLayer2 = new ArcGISDynamicMapServiceLayer("http://new.nowcoast.noaa.gov/arcgis/rest/services/nowcoast/wwa_meteoceanhydro_shortduration_hazards_watches_time/MapServer", {"visible":false, opacity:1.0,refreshInterval:10.0});
			map1.addLayer(Watches_DMSLayer1);	
			map2.addLayer(Watches_DMSLayer2);	
			
			// var QPE_DMSLayer1 = new ArcGISDynamicMapServiceLayer("http://new.nowcoast.noaa.gov/arcgis/rest/services/nowcoast/analysis_meteohydro_sfc_qpe_time/MapServer", {"visible":true, opacity:0.7,refreshInterval:2.5,id:"MRMS"});
			// var QPE_DMSLayer2 = new ArcGISDynamicMapServiceLayer("http://new.nowcoast.noaa.gov/arcgis/rest/services/nowcoast/analysis_meteohydro_sfc_qpe_time/MapServer", {"visible":true, opacity:0.7,refreshInterval:2.5,id:"MRMS"});
			// QPE_DMSLayer1.setVisibleLayers([]);
			// QPE_DMSLayer2.setVisibleLayers([]);
			// map1.addLayer(QPE_DMSLayer1);
			// map2.addLayer(QPE_DMSLayer2);		

			var radarImgParams = new ImageParameters();
			radarImgParams.layerIds = [3];
			radarImgParams.layerOption = ImageParameters.LAYER_OPTION_SHOW;
			var Radar_DMS_url = "http://new.nowcoast.noaa.gov/arcgis/rest/services/nowcoast/radar_meteo_imagery_nexrad_time/MapServer";
			var Radar_DMSLayer1 = new ArcGISDynamicMapServiceLayer(Radar_DMS_url, {"visible":false, opacity:0.8,refreshInterval:1.0,"imageParameters": radarImgParams,id:"Radar"});
			var Radar_DMSLayer2 = new ArcGISDynamicMapServiceLayer(Radar_DMS_url, {"visible":false, opacity:0.8,refreshInterval:1.0,"imageParameters": radarImgParams,id:"Radar"});
			map1.addLayer(Radar_DMSLayer1);		
			map2.addLayer(Radar_DMSLayer2);		

			var Roads_DMSLayer1 = new ArcGISDynamicMapServiceLayer("http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/", {"visible":false, opacity:1.0});
			var Roads_DMSLayer2 = new ArcGISDynamicMapServiceLayer("http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/", {"visible":false, opacity:1.0});
			map1.addLayer(Roads_DMSLayer1);		
			map2.addLayer(Roads_DMSLayer2);		

			
			// //Add QPE Transparent PNGs
			//create an add the actual image
			mil1 = new MapImageLayer({"visible":false});
			mil2 = new MapImageLayer({"visible":false});
			map1.addLayer(mil1);
			map2.addLayer(mil2);
			
			function LoadQPEImage(selectedlayer,Source) {
			milarray = [];
			var box1 = document.getElementById("QPESOURCE1");
			var box2 = document.getElementById("QPESOURCE2");
			if (box1.checked == true){milarray.push(mil1)};
			if (box2.checked == true){milarray.push(mil2)};
			//console.log("Source for Image: " + Source);
			for (i = 0; i < milarray.length; i++) {
			mil = milarray[i];
			//console.log(mil);
			mil.removeAllImages();
			//console.log("SOURCE: " + Source);
			if (Source == 'MRMS'){image = 'MRMS_COLORED_' + selectedlayer + '_TOTAL.png'};
			if (Source == 'DHR'){image = 'OHP_COLORED_' + selectedlayer + '_TOTAL.png'};
			if (Source == 'DPR'){image = 'OHA_COLORED_' + selectedlayer + '_TOTAL.png'};
			//if (Source == 'HPE'){image = 'HPE_COLORED_' + selectedlayer + '_TOTAL.png'};
			//if (Source == 'BHPE'){image = 'BHPE_COLORED_' + selectedlayer + '_TOTAL.png'};
			if (Source == 'WorstCase'){image = 'WorstCase_COLORED_' + selectedlayer + '_TOTAL.png'};
			if (Source == 'BestCase'){image = 'BestCase_COLORED_' + selectedlayer + '_TOTAL.png'};
			if (Source == 'AllBlend'){image = 'AllBlend_COLORED_' + selectedlayer + '_TOTAL.png'};
			if (Source == 'SmartBlend'){image = 'SmartBlend_COLORED_' + selectedlayer + '_TOTAL.png'};
			if (Source != 'HPE' && Source != 'BHPE'){
			//console.log("IMAGE: " + image);
			QPE = new MapImage({'extent': { 'xmin': Xmin, 'ymin': Ymin, 'xmax': Xmax, 'ymax': Ymax, 'spatialReference': { 'wkid': 4326 }},'href': DataDir + image + '?'+new Date().getTime()});
			mil.addImage(QPE);
			};
			};
			};
			
			
			//Add Observed Precip CSV Layers	
			var CSVVALUE = 0.0;

			var csv30min1;
			var csv30mintextLayer1;
			var csv30min2;
			var csv30mintextLayer2;
			function csv30minfunc() {
			csv30min1 = new CSVLayer(DataDir + "30query.csv",{id:"csv30min",refreshInterval: .10});
			csv30mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv30min2 = new CSVLayer(DataDir + "30query.csv",{id:"csv30min",refreshInterval: .10});
			csv30mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv30min1.on("update-end", function(results){
				csv30mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"30 Min FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv30mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv30mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv30mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv30mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv30mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv30mintextLayer1.setInfoTemplate(infoTemplate);

			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv30min1.setRenderer(renderer);	
			
			csv30min2.on("update-end", function(results){
				csv30mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"30 Min FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv30mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv30mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv30mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv30mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv30mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv30mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv30min2.setRenderer(renderer);
			};
			
			csv30minfunc();
			map1.addLayer(csv30min1);
			map1.addLayer(csv30mintextLayer1);	
			map2.addLayer(csv30min2);
			map2.addLayer(csv30mintextLayer2);	
			csv30min1.hide();
			csv30mintextLayer1.hide();
			csv30min2.hide();
			csv30mintextLayer2.hide();
			
			var csv60min1;
			var csv60mintextLayer1;
			var csv60min2;
			var csv60mintextLayer2;
			function csv60minfunc() {
			csv60min1 = new CSVLayer(DataDir + "60query.csv",{id:"csv60min",refreshInterval: .10});
			csv60mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv60min2 = new CSVLayer(DataDir + "60query.csv",{id:"csv60min",refreshInterval: .10});
			csv60mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv60min1.on("update-end", function(results){
				csv60mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"1 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv60mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv60mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv60mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv60mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv60mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv60mintextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv60min1.setRenderer(renderer);	
			
			csv60min2.on("update-end", function(results){
				csv60mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"1 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv60mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv60mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv60mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv60mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv60mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv60mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv60min2.setRenderer(renderer);
			};
			
			csv60minfunc();
			map1.addLayer(csv60min1);
			map1.addLayer(csv60mintextLayer1);	
			map2.addLayer(csv60min2);
			map2.addLayer(csv60mintextLayer2);	
			csv60min1.hide();
			csv60mintextLayer1.hide();
			csv60min2.hide();
			csv60mintextLayer2.hide();
			
			var csv120min1;
			var csv120mintextLayer1;
			var csv120min2;
			var csv120mintextLayer2;
			function csv120minfunc() {
			csv120min1 = new CSVLayer(DataDir + "120query.csv",{id:"csv120min",refreshInterval: .10});
			csv120mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv120min2 = new CSVLayer(DataDir + "120query.csv",{id:"csv120min",refreshInterval: .10});
			csv120mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv120min1.on("update-end", function(results){
				csv120mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"2 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv120mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv120mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv120mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv120mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv120mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv120mintextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv120min1.setRenderer(renderer);	
			
			csv120min2.on("update-end", function(results){
				csv120mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"2 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv120mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv120mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv120mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv120mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv120mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv120mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv120min2.setRenderer(renderer);
			};
			
			csv120minfunc();
			map1.addLayer(csv120min1);
			map1.addLayer(csv120mintextLayer1);	
			map2.addLayer(csv120min2);
			map2.addLayer(csv120mintextLayer2);	
			csv120min1.hide();
			csv120mintextLayer1.hide();
			csv120min2.hide();
			csv120mintextLayer2.hide();
			
			var csv180min1;
			var csv180mintextLayer1;
			var csv180min2;
			var csv180mintextLayer2;
			function csv180minfunc() {
			csv180min1 = new CSVLayer(DataDir + "180query.csv",{id:"csv180min",refreshInterval: .10});
			csv180mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv180min2 = new CSVLayer(DataDir + "180query.csv",{id:"csv180min",refreshInterval: .10});
			csv180mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv180min1.on("update-end", function(results){
				csv180mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"3 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv180mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv180mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv180mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv180mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv180mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv180mintextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv180min1.setRenderer(renderer);	
			
			csv180min2.on("update-end", function(results){
				csv180mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"3 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv180mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv180mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv180mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv180mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv180mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv180mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv180min2.setRenderer(renderer);
			};
			
			csv180minfunc();
			map1.addLayer(csv180min1);
			map1.addLayer(csv180mintextLayer1);	
			map2.addLayer(csv180min2);
			map2.addLayer(csv180mintextLayer2);	
			csv180min1.hide();
			csv180mintextLayer1.hide();
			csv180min2.hide();
			csv180mintextLayer2.hide();
			
			var csv360min1;
			var csv360mintextLayer1;
			var csv360min2;
			var csv360mintextLayer2;
			function csv360minfunc() {
			csv360min1 = new CSVLayer(DataDir + "360query.csv",{id:"csv360min",refreshInterval: .10});
			csv360mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv360min2 = new CSVLayer(DataDir + "360query.csv",{id:"csv360min",refreshInterval: .10});
			csv360mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv360min1.on("update-end", function(results){
				csv360mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"6 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv360mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv360mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv360mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv360mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv360mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv360mintextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv360min1.setRenderer(renderer);	
			
			csv360min2.on("update-end", function(results){
				csv360mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"6 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv360mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv360mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv360mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv360mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv360mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv360mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv360min2.setRenderer(renderer);
			};
			
			csv360minfunc();
			map1.addLayer(csv360min1);
			map1.addLayer(csv360mintextLayer1);	
			map2.addLayer(csv360min2);
			map2.addLayer(csv360mintextLayer2);	
			csv360min1.hide();
			csv360mintextLayer1.hide();
			csv360min2.hide();
			csv360mintextLayer2.hide();
			
			var csv720min1;
			var csv720mintextLayer1;
			var csv720min2;
			var csv720mintextLayer2;
			function csv720minfunc() {
			csv720min1 = new CSVLayer(DataDir + "720query.csv",{id:"csv720min",refreshInterval: .10});
			csv720mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv720min2 = new CSVLayer(DataDir + "720query.csv",{id:"csv720min",refreshInterval: .10});
			csv720mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv720min1.on("update-end", function(results){
				csv720mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"12 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv720mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv720mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv720mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv720mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv720mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv720mintextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv720min1.setRenderer(renderer);	
			
			csv720min2.on("update-end", function(results){
				csv720mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"12 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv720mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv720mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv720mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv720mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv720mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv720mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv720min2.setRenderer(renderer);
			};
			
			csv720minfunc();
			map1.addLayer(csv720min1);
			map1.addLayer(csv720mintextLayer1);	
			map2.addLayer(csv720min2);
			map2.addLayer(csv720mintextLayer2);	
			csv720min1.hide();
			csv720mintextLayer1.hide();
			csv720min2.hide();
			csv720mintextLayer2.hide();
			
			var csv1440min1;
			var csv1440mintextLayer1;
			var csv1440min2;
			var csv1440mintextLayer2;
			function csv1440minfunc() {
			csv1440min1 = new CSVLayer(DataDir + "1440query.csv",{id:"csv1440min",refreshInterval: .10});
			csv1440mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv1440min2 = new CSVLayer(DataDir + "1440query.csv",{id:"csv1440min",refreshInterval: .10});
			csv1440mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv1440min1.on("update-end", function(results){
				csv1440mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"24 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv1440mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv1440mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv1440mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv1440mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv1440mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv1440mintextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv1440min1.setRenderer(renderer);	
			
			csv1440min2.on("update-end", function(results){
				csv1440mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"24 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv1440mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv1440mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv1440mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv1440mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv1440mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv1440mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv1440min2.setRenderer(renderer);
			};
			
			csv1440minfunc();
			map1.addLayer(csv1440min1);
			map1.addLayer(csv1440mintextLayer1);	
			map2.addLayer(csv1440min2);
			map2.addLayer(csv1440mintextLayer2);	
			csv1440min1.hide();
			csv1440mintextLayer1.hide();
			csv1440min2.hide();
			csv1440mintextLayer2.hide();
			
			var csv1441min1;
			var csv1441mintextLayer1;
			var csv1441min2;
			var csv1441mintextLayer2;
			function csv1441minfunc() {
			csv1441min1 = new CSVLayer(DataDir + "1441query.csv",{id:"csv1441min",refreshInterval: .10});
			csv1441mintextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			csv1441min2 = new CSVLayer(DataDir + "1441query.csv",{id:"csv1441min",refreshInterval: .10});
			csv1441mintextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			csv1441min1.on("update-end", function(results){
				csv1441mintextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"24 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv1441mintextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					csv1441mintextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					csv1441mintextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					csv1441mintextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv1441mintextLayer1.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv1441mintextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv1441min1.setRenderer(renderer);	
			
			csv1441min2.on("update-end", function(results){
				csv1441mintextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					var lid =  feature.attributes.lid;
					var name =  feature.attributes.name;
					var value = feature.attributes.value;
					var topperformer = feature.attributes.topperformer;
					if (value >= CSVVALUE) {
					var ffg = feature.attributes.ffg;
					var ratio = feature.attributes.ratio;
					var validtime = feature.attributes.obstime;
					var validtime = validtime.split("/");
					var validstarttime = validtime[0];
					var validendtime = validtime[1];
					var attr = {"Location ID":lid.bold(),"Location Name":name,"Obs Value":value.bold() + '"',"24 Hour FFG":ffg + '"',"Ratio of FFG":ratio.bold() + "%","Top QPE Performer":topperformer.bold(),"Accumulation Start":validstarttime,"Accumulation End":validendtime};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextRatio = feature.attributes.ratio;
					returnedvalues = ratioColor(displayTextRatio);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					csv1441mintextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					csv1441mintextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					csv1441mintextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					csv1441mintextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica");
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					csv1441mintextLayer2.add(new Graphic(geom, textSymbol, attr));
					}
					});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				csv1441mintextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			csv1441min2.setRenderer(renderer);
			};
			
			csv1441minfunc();
			map1.addLayer(csv1441min1);
			map1.addLayer(csv1441mintextLayer1);	
			map2.addLayer(csv1441min2);
			map2.addLayer(csv1441mintextLayer2);	
			csv1441min1.hide();
			csv1441mintextLayer1.hide();
			csv1441min2.hide();
			csv1441mintextLayer2.hide();
			
			//Add Latest RiverStages CSV Layers
			var LatestRiverStages1;
			var LatestRiverStagestextLayer1;
			var LatestRiverStages2;
			var LatestRiverStagestextLayer2;
			function LatestRiverStagesfunc () {
			LatestRiverStages1 = new CSVLayer(DataDir + "riverquery.csv",{id:"LatestRiverStages",refreshInterval: .10});
			LatestRiverStagestextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			LatestRiverStages2 = new CSVLayer(DataDir + "riverquery.csv",{id:"LatestRiverStages",refreshInterval: .10});
			LatestRiverStagestextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			LatestRiverStages1.on("update-end", function(results){          
				LatestRiverStagestextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map1.infoWindow.resize(500,600);
					var lid =  feature.attributes.lid;
					var value = feature.attributes.value;
					var validtime = feature.attributes.validtime;
					var actionflood = feature.attributes.action;
					var minorflood = feature.attributes.minorflood;
					var moderateflood = feature.attributes.moderateflood;
					var majorflood = feature.attributes.majorflood;
					var stagecat = feature.attributes.stagecat;
					var upgradedeparture = feature.attributes.upgradedeparture;
					var res = lid.toLowerCase();
					var url = "http://water.weather.gov/resources/hydrographs/" + res + "_hg.png";
					var url2 = "http://water.weather.gov/ahps2/hydrograph.php?wfo=" + CWA.toLowerCase() + "&gage=" + res;
					var linky = '<a href="' + url + '">Link To Hydrograph Below</a>' + '<img name="theImage" src="' + url + '" height="360" width="480" alt=" HydroGraph Not Available"/>';
					var linky2 = '<a href="' + url2 + '">Link To Page</a>';
					var attr = {"Location ID":lid.bold(),"Value":value.bold(),"Valid Time":validtime,"Action Stage":actionflood,"Minor Flood":minorflood,"Moderate Flood":moderateflood,"Major Flood":majorflood,"Current Stage Category":stagecat.bold(),"Departure From Upgrade":upgradedeparture.bold(),"HydroGraph Page":linky2};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextstagecat = feature.attributes.stagecat;
					returnedvalues = ratioColor(displayTextstagecat);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					LatestRiverStagestextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
					LatestRiverStagestextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
					LatestRiverStagestextLayer1.add(new Graphic(geom, textSymbolEast, attr));
					LatestRiverStagestextLayer1.add(new Graphic(geom, textSymbolWest, attr));
					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					LatestRiverStagestextLayer1.add(new Graphic(geom, textSymbol, attr));});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestRiverStagestextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestRiverStages1.setRenderer(renderer);	

			LatestRiverStages2.on("update-end", function(results){          
				LatestRiverStagestextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map2.infoWindow.resize(500,600);
					var lid =  feature.attributes.lid;
					var value = feature.attributes.value;
					var validtime = feature.attributes.validtime;
					var actionflood = feature.attributes.action;
					var minorflood = feature.attributes.minorflood;
					var moderateflood = feature.attributes.moderateflood;
					var majorflood = feature.attributes.majorflood;
					var stagecat = feature.attributes.stagecat;
					var upgradedeparture = feature.attributes.upgradedeparture;
					var res = lid.toLowerCase();
					var url = "http://water.weather.gov/resources/hydrographs/" + res + "_hg.png";
					var url2 = "http://water.weather.gov/ahps2/hydrograph.php?wfo=" + CWA.toLowerCase() + "&gage=" + res;
					var linky = '<a href="' + url + '">Link To Hydrograph Below</a>' + '<img name="theImage" src="' + url + '" height="360" width="480" alt=" HydroGraph Not Available"/>';
					var linky2 = '<a href="' + url2 + '">Link To Page</a>';
					var attr = {"Location ID":lid.bold(),"Value":value.bold(),"Valid Time":validtime,"Action Stage":actionflood,"Minor Flood":minorflood,"Moderate Flood":moderateflood,"Major Flood":majorflood,"Current Stage Category":stagecat.bold(),"Departure From Upgrade":upgradedeparture.bold(),"HydroGraph Page":linky2};                                                                               
					var geom = feature.geometry;
					var displayText = feature.attributes.value;
					var displayTextstagecat = feature.attributes.stagecat;
					returnedvalues = ratioColor(displayTextstagecat);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);
					LatestRiverStagestextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
					LatestRiverStagestextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
					LatestRiverStagestextLayer2.add(new Graphic(geom, textSymbolEast, attr));
					LatestRiverStagestextLayer2.add(new Graphic(geom, textSymbolWest, attr));
					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));						
					LatestRiverStagestextLayer2.add(new Graphic(geom, textSymbol, attr));});                        
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestRiverStagestextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestRiverStages2.setRenderer(renderer);	
			};
			
			LatestRiverStagesfunc();
			map1.addLayer(LatestRiverStages1);
			map1.addLayer(LatestRiverStagestextLayer1);	
			map2.addLayer(LatestRiverStages2);
			map2.addLayer(LatestRiverStagestextLayer2);	
			LatestRiverStages1.hide();
			LatestRiverStagestextLayer1.hide();
			LatestRiverStages2.hide();
			LatestRiverStagestextLayer2.hide();
			
			
			//Add Latest Temperature CSV Layers
			var LatestTemperatures1;
			var LatestTemperaturestextLayer1;
			var LatestTemperatures2;
			var LatestTemperaturestextLayer2;
			function LatestTemperaturesfunc () {
			LatestTemperatures1 = new CSVLayer(DataDir + "tempsquery.csv",{id:"LatestTemperatures",refreshInterval: .10});
			LatestTemperaturestextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			LatestTemperatures2 = new CSVLayer(DataDir + "tempsquery.csv",{id:"LatestTemperatures",refreshInterval: .10});
			LatestTemperaturestextLayer2 = new GraphicsLayer({refreshInterval: .10}); 
			LatestTemperatures1.on("update-end", function(results){          
				LatestTemperaturestextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map1.infoWindow.resize(200,200);
					var lid =  feature.attributes.lid;
					var temperature = feature.attributes.temp;
					var validtime = feature.attributes.validtime;
					var attr = {"Location ID":lid.bold(),"Temperature":temperature.bold(),"Valid Time":validtime};                                                                               
					var geom = feature.geometry;
					if (temperature < 33) {coloralt = Cyan;FontSize = '18';HaloColor = Black;};
					if (temperature > 32 && temperature < 35) {coloralt = Yellow;FontSize = '16';HaloColor = Black;};
					if (temperature > 34) {coloralt = Black;FontSize = '14';HaloColor = White;};
					var displayText = temperature;
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));
					if (temperature < 9999) {
						LatestTemperaturestextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
						LatestTemperaturestextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
						LatestTemperaturestextLayer1.add(new Graphic(geom, textSymbolEast, attr));
						LatestTemperaturestextLayer1.add(new Graphic(geom, textSymbolWest, attr));					
						LatestTemperaturestextLayer1.add(new Graphic(geom, textSymbol, attr));
						}
					});   				
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestTemperaturestextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestTemperatures1.setRenderer(renderer);		

			LatestTemperatures2.on("update-end", function(results){          
				LatestTemperaturestextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map2.infoWindow.resize(200,200);
					var lid =  feature.attributes.lid;
					var temperature = feature.attributes.temp;
					var validtime = feature.attributes.validtime;
					var attr = {"Location ID":lid.bold(),"Temperature":temperature.bold(),"Valid Time":validtime};                                                                               
					var geom = feature.geometry;
					if (temperature < 33) {coloralt = Cyan;FontSize = '18';HaloColor = Black;};
					if (temperature > 32 && temperature < 35) {coloralt = Yellow;FontSize = '16';HaloColor = Black;};
					if (temperature > 34) {coloralt = Black;FontSize = '14';HaloColor = White;};
					var displayText = temperature;
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));
					if (temperature < 9999) {
						LatestTemperaturestextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
						LatestTemperaturestextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
						LatestTemperaturestextLayer2.add(new Graphic(geom, textSymbolEast, attr));
						LatestTemperaturestextLayer2.add(new Graphic(geom, textSymbolWest, attr));					
						LatestTemperaturestextLayer2.add(new Graphic(geom, textSymbol, attr));
						}
					});   				
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestTemperaturestextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestTemperatures2.setRenderer(renderer);		
			};
			
			LatestTemperaturesfunc();
			map1.addLayer(LatestTemperatures1);
			map1.addLayer(LatestTemperaturestextLayer1);	
			map2.addLayer(LatestTemperatures2);
			map2.addLayer(LatestTemperaturestextLayer2);
			LatestTemperatures1.hide();
			LatestTemperaturestextLayer1.hide();
			LatestTemperatures2.hide();
			LatestTemperaturestextLayer2.hide();
			
			
			//Add Latest WindGusts CSV Layers
			var LatestWindGusts1;
			var LatestWindGuststextLayer1;
			var LatestWindGusts2;
			var LatestWindGuststextLayer2;
			function LatestWindGustsfunc () {
			LatestWindGusts1 = new CSVLayer(DataDir + "windsquery.csv",{id:"LatestWindGusts",refreshInterval: .10});
			LatestWindGuststextLayer1 = new GraphicsLayer({refreshInterval: .10});  
			LatestWindGusts2 = new CSVLayer(DataDir + "windsquery.csv",{id:"LatestWindGusts",refreshInterval: .10});
			LatestWindGuststextLayer2 = new GraphicsLayer({refreshInterval: .10});  
			LatestWindGusts1.on("update-end", function(results){          
				LatestWindGuststextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map1.infoWindow.resize(200,200);
					var lid =  feature.attributes.lid;
					var winds = feature.attributes.winds;
					var windg = feature.attributes.windg;
					var windd = feature.attributes.windd;
					if (windd == 9999) {windd = ""};
					var validtime = feature.attributes.validtime;                                                                 
					var geom = feature.geometry;
					if (windg >= 10 && windg < 9999) {
					var displayText = winds + 'G' + windg;
					var attr = {"Location ID":lid,"Sustained Wind":winds.bold() + "mph".bold(),"Wind Gust":windg.bold() + "mph".bold(),"Wind Direction":windd,"Valid Time":validtime}; 
					} else {
					var displayText = winds;
					var attr = {"Location ID":lid,"Sustained Wind":winds.bold() + "mph".bold(),"Wind Gust":"","Wind Direction":windd,"Valid Time":validtime}; 
					}
					returnedvalues = WindColor(winds,windg);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));
					if (winds >= 0 && winds < 9999) {
						LatestWindGuststextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
						LatestWindGuststextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
						LatestWindGuststextLayer1.add(new Graphic(geom, textSymbolEast, attr));
						LatestWindGuststextLayer1.add(new Graphic(geom, textSymbolWest, attr));					
						LatestWindGuststextLayer1.add(new Graphic(geom, textSymbol, attr));
						}
					});
								
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestWindGuststextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestWindGusts1.setRenderer(renderer);			
			
			LatestWindGusts2.on("update-end", function(results){          
				LatestWindGuststextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map2.infoWindow.resize(200,200);
					var lid =  feature.attributes.lid;
					var winds = feature.attributes.winds;
					var windg = feature.attributes.windg;
					var windd = feature.attributes.windd;
					if (windd == 9999) {windd = ""};
					var validtime = feature.attributes.validtime;                                                                 
					var geom = feature.geometry;
					if (windg >= 10 && windg < 9999) {
					var displayText = winds + 'G' + windg;
					var attr = {"Location ID":lid,"Sustained Wind":winds.bold() + "mph".bold(),"Wind Gust":windg.bold() + "mph".bold(),"Wind Direction":windd,"Valid Time":validtime}; 
					} else {
					var displayText = winds;
					var attr = {"Location ID":lid,"Sustained Wind":winds.bold() + "mph".bold(),"Wind Gust":"","Wind Direction":windd,"Valid Time":validtime}; 
					}
					returnedvalues = WindColor(winds,windg);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));
					if (winds >= 0 && winds < 9999) {
						LatestWindGuststextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
						LatestWindGuststextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
						LatestWindGuststextLayer2.add(new Graphic(geom, textSymbolEast, attr));
						LatestWindGuststextLayer2.add(new Graphic(geom, textSymbolWest, attr));					
						LatestWindGuststextLayer2.add(new Graphic(geom, textSymbol, attr));
						}
					});
								
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestWindGuststextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestWindGusts2.setRenderer(renderer);	
			};
			
			LatestWindGustsfunc();
			map1.addLayer(LatestWindGusts1);
			map1.addLayer(LatestWindGuststextLayer1);	
			map2.addLayer(LatestWindGusts2);
			map2.addLayer(LatestWindGuststextLayer2);	
			LatestWindGusts1.hide();
			LatestWindGuststextLayer1.hide();	
			LatestWindGusts2.hide();
			LatestWindGuststextLayer2.hide();	
			
			//Add Latest WindChill CSV Layers
			var LatestWindChill1;
			var LatestWindChilltextLayer1;
			var LatestWindChill2;
			var LatestWindChilltextLayer2;
			function LatestWindChillfunc () {
			LatestWindChill1 = new CSVLayer(DataDir + "tempwindsquery.csv",{id:"LatestWindChill",refreshInterval: .50});
			LatestWindChilltextLayer1 = new GraphicsLayer({refreshInterval: .50});  
			LatestWindChill2 = new CSVLayer(DataDir + "tempwindsquery.csv",{id:"LatestWindChill",refreshInterval: .50});
			LatestWindChilltextLayer2 = new GraphicsLayer({refreshInterval: .50});  
			LatestWindChill1.on("update-end", function(results){          
				LatestWindChilltextLayer1.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map1.infoWindow.resize(200,200);
					var lid =  feature.attributes.lid;
					var winds = feature.attributes.winds;
					var windg = feature.attributes.windg;
					var windd = feature.attributes.windd;
					var temperature = feature.attributes.temp;
					var windchill = feature.attributes.windchill;
					var validtime = feature.attributes.validtime;
					var attr = {"Location ID":lid.bold(),"Wind Chill Temperature":windchill.bold(),"Temperature":temperature,"Sustained Wind":winds,"Wind Gust":windg,"Wind Direction":windd,"Valid Time":validtime};                                                                               
					var geom = feature.geometry;
					var displayText = windchill;
					returnedvalues = WCColor(windchill);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));
					if (windchill <= 40) {
						LatestWindChilltextLayer1.add(new Graphic(geom, textSymbolSouth, attr));
						LatestWindChilltextLayer1.add(new Graphic(geom, textSymbolNorth, attr));
						LatestWindChilltextLayer1.add(new Graphic(geom, textSymbolEast, attr));
						LatestWindChilltextLayer1.add(new Graphic(geom, textSymbolWest, attr));					
						LatestWindChilltextLayer1.add(new Graphic(geom, textSymbol, attr));
						}
					});
								
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestWindChilltextLayer1.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestWindChill1.setRenderer(renderer);		

			LatestWindChill2.on("update-end", function(results){          
				LatestWindChilltextLayer2.clear();
				arrayUtils.forEach(results.target.graphics, function(feature, index){
					//map1.infoWindow.resize(200,200);
					var lid =  feature.attributes.lid;
					var winds = feature.attributes.winds;
					var windg = feature.attributes.windg;
					var windd = feature.attributes.windd;
					var temperature = feature.attributes.temp;
					var windchill = feature.attributes.windchill;
					var validtime = feature.attributes.validtime;
					var attr = {"Location ID":lid.bold(),"Wind Chill Temperature":windchill.bold(),"Temperature":temperature,"Sustained Wind":winds,"Wind Gust":windg,"Wind Direction":windd,"Valid Time":validtime};                                                                               
					var geom = feature.geometry;
					var displayText = windchill;
					returnedvalues = WCColor(windchill);
					coloralt = returnedvalues[0];
					FontSize = returnedvalues[1];
					HaloColor = returnedvalues[2];
					var Halofont = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLDER,"Helvetica"); 
					var textSymbolSouth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolSouth.setOffset(0,-1);
					var textSymbolNorth = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolNorth.setOffset(0,1);
					var textSymbolEast = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolEast.setOffset(1,0);
					var textSymbolWest = new TextSymbol(displayText,Halofont,new Color(HaloColor));
					textSymbolWest.setOffset(-1,0);					
					var font = new Font(FontSize,Font.STYLE_NORMAL, Font.VARIANT_NORMAL,Font.WEIGHT_BOLD,"Helvetica"); 
					var textSymbol = new TextSymbol(displayText,font,new Color(coloralt));
					if (windchill <= 40) {
						LatestWindChilltextLayer2.add(new Graphic(geom, textSymbolSouth, attr));
						LatestWindChilltextLayer2.add(new Graphic(geom, textSymbolNorth, attr));
						LatestWindChilltextLayer2.add(new Graphic(geom, textSymbolEast, attr));
						LatestWindChilltextLayer2.add(new Graphic(geom, textSymbolWest, attr));					
						LatestWindChilltextLayer2.add(new Graphic(geom, textSymbol, attr));
						}
					});
								
				var infoTemplate = new InfoTemplate('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Attributes</p>', "${*}");      
				LatestWindChilltextLayer2.setInfoTemplate(infoTemplate);
			});                                
			var blank = new Color([0, 0, 0, 0]); // hex is #ff4500
			var marker = new SimpleMarkerSymbol("solid", 0, null, blank);
			var renderer = new SimpleRenderer(marker);
			LatestWindChill2.setRenderer(renderer);	
			};
			
			LatestWindChillfunc();
			map1.addLayer(LatestWindChill1);
			map1.addLayer(LatestWindChilltextLayer1);	
			map2.addLayer(LatestWindChill2);
			map2.addLayer(LatestWindChilltextLayer2);	
			LatestWindChill1.hide();
			LatestWindChilltextLayer1.hide();	
			LatestWindChill2.hide();
			LatestWindChilltextLayer2.hide();


			//Build JSON layer for Spotters and Various Layers
			jsonTypeDict = {"AP":"Airport","COOP":"COOP","DAM":"Dam","GC":"Golf Course","FD":"Fire Dept","UV":"College/University","CG":"Campground","GY":"Grocery",
							"MA":"Marina","OTHER":"Other","PK":"Park","RT":"Racetrack","SC":"School","ST":"Store","PD":"Police Dept","PO":"Post Office","SPOT":"Spotter",
							"NBA":"NBA Arena","MLB":"MLB Arena","NFL":"NFL Stadium","MLS":"MLS Arena","NCAAF":"College Football Stadium Div 1","NCAAB":"College Basketball Arena Div 1","NASCAR":"NASCAR Track"}
			var VL_JSONtemplate = new InfoTemplate();
			VL_JSONtemplate.setTitle('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Location Attributes</p>');
			VL_JSONtemplate.setContent(getVL_JSONtemplateTextContent);	
			var Spotters1 = new GraphicsLayer({id:"Spotters",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var Spotters2 = new GraphicsLayer({id:"Spotters",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var fire1 = new GraphicsLayer({id:"fire",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var fire2 = new GraphicsLayer({id:"fire",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var police1 = new GraphicsLayer({id:"police",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var police2 = new GraphicsLayer({id:"police",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var postoffice1 = new GraphicsLayer({id:"postoffice",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var postoffice2 = new GraphicsLayer({id:"postoffice",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var schools1 = new GraphicsLayer({id:"schools",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var schools2 = new GraphicsLayer({id:"schools",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var OtherContacts1 = new GraphicsLayer({id:"OtherContacts",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			var OtherContacts2 = new GraphicsLayer({id:"OtherContacts",outFields:["*"],infoTemplate:VL_JSONtemplate,"visible":false}); 
			function MakeVL_JSON(){ 
					xhr(MainDir + 'staticdata/' + "VLJSON.json", {  
						handleAs: "Json",  
						sync: "true"  
						}).then(lang.hitch(document, function(data){
						locations = JSON.parse(data);
						arrayUtils.forEach(locations.rows, function(feature){
							var pt = new Point(feature.LON, feature.LAT, new SpatialReference({ wkid: 4326 }));  
							var name = feature.NAME;
							var address = feature.ADDRESS;
							var phone = feature.PHONE;
							var city = feature.CITY;
							var county = feature.COUNTY;
							var state = feature.STATE;
							var type = feature.TYPE;
							formaltype = jsonTypeDict[type];
							var attr = {"NAME":name,"ADDRESS":address,"PHONE":phone,"CITY":city,"COUNTY":county,"STATE":state,"TYPE":formaltype};  
							if (type == "SPOT"){
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/Clue.png","contentType":"image/png","width":15,"height":15});
								Spotters1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								Spotters2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "FD"){
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/SafetyHealth/FireTruck.png","contentType":"image/png","width":15,"height":15});
								fire1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								fire2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "PD"){					
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/SafetyHealth/PoliceCar.png","contentType":"image/png","width":14,"height":14});
								police1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								police2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "PO"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/MailPost.png","contentType":"image/png","width":15,"height":15});
								postoffice1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								postoffice2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "SC" || type == "UV"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png","contentType":"image/png","width":12,"height":12});
								schools1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								schools2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								
							//Now Add to OtherContacts
							} else if (type == "AP"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/AirStrip.png","contentType":"image/png","width":20,"height":20});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "COOP"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/esriBusinessMarker_53.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "DAM"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/Dam.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "GC"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/OutdoorRecreation/Golf.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "CG"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/OutdoorRecreation/Camping.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "GY"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/Shopping.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "MA"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/OutdoorRecreation/BoatLaunch.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "PK"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/OutdoorRecreation/Park.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
							} else if (type == "RT"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Basic/CheckeredFlag.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));								
							} else if (type == "ST"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/Shopping.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));	
							} else if (type == "NBA" || type == "MLB" || type == "NFL" || type == "MLS" || type == "NCAAF" || type == "NCAAB"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/OutdoorRecreation/Sports.png","contentType":"image/png","width":25,"height":25});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));		
							} else if (type == "NASCAR"){						
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Basic/CheckeredFlag.png","contentType":"image/png","width":25,"height":25});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));									
							} else {
								sms = new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/PeoplePlaces/CellPhone.png","contentType":"image/png","width":15,"height":15});
								OtherContacts1.add(new Graphic(pt,sms,attr,VL_JSONtemplate));
								OtherContacts2.add(new Graphic(pt,sms,attr,VL_JSONtemplate));								
							};																				
						});
					}));
					map1.addLayer(Spotters1);  
					map2.addLayer(Spotters2);   
					map1.addLayer(fire1);  
					map2.addLayer(fire2); 
					map1.addLayer(police1);  
					map2.addLayer(police2); 
					map1.addLayer(postoffice1);  
					map2.addLayer(postoffice2); 
					map1.addLayer(schools1);  
					map2.addLayer(schools2); 
					map1.addLayer(OtherContacts1);  
					map2.addLayer(OtherContacts2); 					
			};
			
			function getVL_JSONtemplateTextContent (graphic) {
            var attributes = graphic.attributes;
			var name = "Name: " + attributes.NAME;
			var phone = "Phone: " + attributes.PHONE;
			var address = "Address: " + attributes.ADDRESS;
			var city = "City: " + attributes.CITY;
			var county = "County: " + attributes.COUNTY;
			var state = "State: " + attributes.STATE;
			var formaltype = "Type: " + attributes.TYPE;
			return name + "</b><br />" + phone + "</b><br />" + address + "</b><br />" + city + "</b><br />" + county + "</b><br />" + state + "</b><br />" + formaltype;
			};		
			MakeVL_JSON();
										
			//Add Flood Events CSV Layers
			var FloodEventsCSVtemplate = new InfoTemplate();
			FloodEventsCSVtemplate.setTitle('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Flood Event Attributes</p>');
			FloodEventsCSVtemplate.setContent(getFloodEventsCSVTextContent);
		    var FloodEvents1 = new CSVLayer("./eventdata/flood.csv",{id:"FloodEvents",mode: FeatureLayer.MODE_SELECTION,outFields: ["*"],infoTemplate: FloodEventsCSVtemplate});
			var FloodEvents2 = new CSVLayer("./eventdata/flood.csv",{id:"FloodEvents",mode: FeatureLayer.MODE_SELECTION,outFields: ["*"],infoTemplate: FloodEventsCSVtemplate});
			var symbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png","contentType":"image/png","width":16,"height":16});
			var renderer = new SimpleRenderer(symbol);
			FloodEvents1.setRenderer(renderer);
			FloodEvents2.setRenderer(renderer);
			map1.addLayer(FloodEvents1);
			map2.addLayer(FloodEvents2);
			FloodEvents1.hide();
			FloodEvents2.hide();
			
			function getFloodEventsCSVTextContent (graphic) {
			// map.infoWindow.resize(500,480);
            var attributes = graphic.attributes;
			var location = "Location: " + attributes.CITY;
			var description = "Description: " + attributes.DESCRIPTION;
			return location + "</b><br />" + description;
			};
			
			//Add NCLand Slide Events CSV Layers
			var NCLandSlidesCSVtemplate = new InfoTemplate();
			NCLandSlidesCSVtemplate.setTitle('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Land Slide Attributes</p>');
			NCLandSlidesCSVtemplate.setContent(getNCLandSlidesCSVTextContent);
		    var NCLandSlides1 = new CSVLayer("./eventdata/nclandslides.csv",{id:"NCLandSlides",mode: FeatureLayer.MODE_SELECTION,outFields: ["*"],infoTemplate: NCLandSlidesCSVtemplate});
			var NCLandSlides2 = new CSVLayer("./eventdata/nclandslides.csv",{id:"NCLandSlides",mode: FeatureLayer.MODE_SELECTION,outFields: ["*"],infoTemplate: NCLandSlidesCSVtemplate});
			var symbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Basic/PurpleSphere.png","contentType":"image/png","width":16,"height":16});
			var renderer = new SimpleRenderer(symbol);
			NCLandSlides1.setRenderer(renderer);
			NCLandSlides2.setRenderer(renderer);
			map1.addLayer(NCLandSlides1);
			map2.addLayer(NCLandSlides2);
			NCLandSlides1.hide();
			NCLandSlides2.hide();
			
			function getNCLandSlidesCSVTextContent (graphic) {
            var attributes = graphic.attributes;
			var name = "Slope Movement Name: " + attributes.SM_NAME;
			var type = "Slope Movement Type: " + attributes.SM_TYPE;
			var date = "Slope Movement Date: " + attributes.MVMT_DATE;
			var road = "Slope Movement Road: " + attributes.ROAD;
			var aspect = "Slope Aspect: " + attributes.SA_ASPCT;
			var headelev = "Movement Head Elevation (ft): " + attributes.EL_HEAD;
			var source = "Data Source: " + attributes.DATA_SRC;
			return name + "</b><br />" + type + "</b><br />" + date  + "</b><br />" + road + "</b><br />" + aspect + "</b><br />" + headelev + "</b><br />" + source
			};	
			
			//Add RainObs CSV Layers
			var RainObsCSVtemplate = new InfoTemplate();
			RainObsCSVtemplate.setTitle('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Observation Attributes</p>');
			RainObsCSVtemplate.setContent(getRainObsCSVTextContent);
		    var RainObs1 = new CSVLayer(DataDir + "sitesquery.csv",{id:"RainObs",mode: FeatureLayer.MODE_SNAPSHOT,outFields: ["*"],infoTemplate: RainObsCSVtemplate});
			var RainObs2 = new CSVLayer(DataDir + "sitesquery.csv",{id:"RainObs",mode: FeatureLayer.MODE_SNAPSHOT,outFields: ["*"],infoTemplate: RainObsCSVtemplate});
			var IFLOWSsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/BlueBeacon.png","contentType":"image/png","width":12,"height":12});
			var ASOSsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/RedBeacon.png","contentType":"image/png","width":12,"height":12});
			var UTILITYsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/WhiteBeacon.png","contentType":"image/png","width":12,"height":12});
			var MESONETsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/GreenBeacon.png","contentType":"image/png","width":12,"height":12});
			var COOPsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/BlackBeacon.png","contentType":"image/png","width":12,"height":12});
			var DCPsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/VioletBeacon.png","contentType":"image/png","width":12,"height":12});
			var COCORAHSsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/OrangeBeacon.png","contentType":"image/png","width":12,"height":12});
			var ECONETsymbol =  new PictureMarkerSymbol({"angle":0,"xoffset":0,"yoffset":0,"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Transportation/AmberBeacon.png","contentType":"image/png","width":12,"height":12});
			var defaultSymbol = new SimpleFillSymbol().setStyle(SimpleFillSymbol.STYLE_NULL);
			defaultSymbol.outline.setStyle(SimpleLineSymbol.STYLE_NULL);
			var renderer = new UniqueValueRenderer(defaultSymbol, "obtype");
			renderer.addValue("IFLOWS/ALERT/LARC", IFLOWSsymbol);
			renderer.addValue("ASOS/AWOS", ASOSsymbol);
			renderer.addValue("Utilities", UTILITYsymbol);
			renderer.addValue("Mesonet", MESONETsymbol);
			renderer.addValue("COOP", COOPsymbol);
			renderer.addValue("DCP", DCPsymbol);
			renderer.addValue("CoCoRaHS", COCORAHSsymbol);
			renderer.addValue("ECONet", ECONETsymbol);
			RainObs1.setRenderer(renderer);
			RainObs2.setRenderer(renderer);
			map1.addLayer(RainObs1);
			map2.addLayer(RainObs2);
			RainObs1.hide();
			RainObs2.hide();
			
			function getRainObsCSVTextContent (graphic) {
            var attributes = graphic.attributes;
			var sid = "SID: " + attributes.lid;
			var lat = "Latitude: " + attributes.lat;
			var lon = "Longitude: " + attributes.lon;
			var name = "Name: " + attributes.name;
			var elev = "Elevation: " + attributes.elev;
			var obtype = "Ob Type: " + attributes.obtype;
			return sid + "</b><br />" + name + "</b><br />" + elev  + "</b><br />" + lat + "</b><br />" + lon + "</b><br />" + obtype
			};		
			
			//Add Spot Forecast JSON Layer
			var SpotForecastCSVtemplate = new InfoTemplate();
			SpotForecastCSVtemplate.setTitle('<p style="text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;";>Spot Forecast Attributes</p>');
			SpotForecastCSVtemplate.setContent(getSpotForecastCSVTextContent);	
			var SpotForecast1 = new GraphicsLayer({id:"SpotForecast",outFields: ["*"],infoTemplate: SpotForecastCSVtemplate}); 
			var SpotForecast2 = new GraphicsLayer({id:"SpotForecast",outFields: ["*"],infoTemplate: SpotForecastCSVtemplate}); 
			function GenerateSPOTS(){ 
					SpotForecast1.clear();
					SpotForecast2.clear();
					xhr(DataDir + "SPOTSraw.json", {  
						handleAs: "Json",  
						sync: "true"  
						}).then(lang.hitch(document, function(data){
						locations = JSON.parse(data);
						arrayUtils.forEach(locations.rows, function(feature){
							var pt = new Point(feature.lon, feature.lat, new SpatialReference({ wkid: 4326 }));  
							var typepre = feature.type;
							var type = typepre.split("<br>")[0];
							var name = feature.name;
							var rtime = feature.rmade;
							var dtime = feature.deliverdtg;
							var stat = feature.stat;
							if (stat == 'C'){stat = 'Completed'};
							if (stat == 'P'){stat = 'Pending'};
							var wfo  = feature.wfo;
							
							if (type == 'SAR'){
								if (stat == 'Pending'){
								sms = new PictureMarkerSymbol('http://static.arcgis.com/images/Symbols/Transportation/HelicopterRed.png', 55, 55);
								} else {
								sms = new PictureMarkerSymbol('http://static.arcgis.com/images/Symbols/Transportation/HelicopterRed.png', 35, 35);
								};
							} else {	
								if (stat == 'Pending'){
								sms = new PictureMarkerSymbol('http://static.arcgis.com/images/Symbols/SafetyHealth/esriCrimeMarker_56_Gradient.png', 55, 55);
								} else {
								sms = new PictureMarkerSymbol('http://static.arcgis.com/images/Symbols/SafetyHealth/esriCrimeMarker_56_Gradient.png', 35, 35);
							};
							};	
							
							var attr = {"NAME":name,"TYPE":type,"RTIME":rtime,"DTIME":dtime,"STATUS":stat,"WFO":wfo};  
							var graphic1 = new Graphic(pt,sms,attr,SpotForecastCSVtemplate);   
							var graphic2 = new Graphic(pt,sms,attr,SpotForecastCSVtemplate); 							
							SpotForecast1.add(graphic1);
							SpotForecast2.add(graphic2);
						});
					}));
					map1.addLayer(SpotForecast1);  
					map2.addLayer(SpotForecast2);       
				};

			function getSpotForecastCSVTextContent (graphic) {
            var attributes = graphic.attributes;
			var location = "Location Name: " + attributes.NAME;
			var type = "Type: " + attributes.TYPE;
			var rdts = "Requested At: " + attributes.RTIME;
			var ddts = "Deliver By: " + attributes.DTIME;
			var status = "Status: " + attributes.STATUS;
			var spotwfo = "WFO: " + attributes.WFO;
			return location + "</b><br />" + type + "</b><br />" + rdts + "</b><br />" + ddts + "</b><br />" + status + "</b><br />" + spotwfo};
				
			GenerateSPOTS();
			SpotForecast1.hide();
			SpotForecast2.hide(); 
			
			
		//Assign BasinTable Cell Color
		function SetBasinColor(value,BasinPlotType){
				var backgroundcolor;
				
					if (BasinPlotType == 'Ratio') {
					ratio = value;
					if (ratio > 0.00 && ratio < 5.00) {backgroundcolor = Cyan0};
					if (ratio >= 5.00 && ratio < 10.00) {backgroundcolor = Cyan1}; 
					if (ratio >= 10.00 && ratio < 20.00) {backgroundcolor = Cyan2}; 
					if (ratio >= 20.00 && ratio < 30.00) {backgroundcolor = Blue1}; 
					if (ratio >= 30.00 && ratio < 40.00) {backgroundcolor = Green1};
					if (ratio >= 40.00 && ratio < 50.00) {backgroundcolor = Green2}; 
					if (ratio >= 50.00 && ratio < 60.00) {backgroundcolor = Green3}; 
					if (ratio >= 60.00 && ratio < 70.00) {backgroundcolor = Yellow1}; 
					if (ratio >= 70.00 && ratio < 75.00) {backgroundcolor = Orange1};
					if (ratio >= 75.00 && ratio < 80.00) {backgroundcolor = Orange2}; 
					if (ratio >= 80.00 && ratio < 85.00) {backgroundcolor = Red1}; 
					if (ratio >= 85.00 && ratio < 90.00) {backgroundcolor = Red2}; 
					if (ratio >= 90.00 && ratio < 95.00) {backgroundcolor = Red3}; 
					if (ratio >= 95.00 && ratio < 100.00) {backgroundcolor = Pink1}; 
					if (ratio >= 100.00 && ratio < 200.00) {backgroundcolor = Purple1}; 			
					if (ratio >= 200.00) {backgroundcolor = White1};
					};
					
					if (BasinPlotType == 'Diff') {
					diff = value;
					if (diff > -3.00 && diff <= -2.50) {backgroundcolor = Cyan1}; 
					if (diff > -2.50 && diff <= -2.00) {backgroundcolor = Cyan2}; 
					if (diff > -2.00 && diff <= -1.50) {backgroundcolor = Blue1};
					if (diff > -1.50 && diff <= -1.00) {backgroundcolor = Green1};
					if (diff > -1.00 && diff <= -0.75) {backgroundcolor = Green2}; 
					if (diff > -0.75 && diff <= -0.50) {backgroundcolor = Green3}; 
					if (diff > -0.50 && diff < -0.25) {backgroundcolor = Yellow1}; 
					if (diff >= -0.25 && diff <= 0.25) {backgroundcolor = Orange1};
					if (diff > 0.25 && diff <= 0.50) {backgroundcolor = Orange2}; 
					if (diff > 0.50 && diff <= 0.75) {backgroundcolor = Red1}; 
					if (diff > 0.75 && diff <= 1.00) {backgroundcolor = Red2}; 
					if (diff > 1.00 && diff <= 1.50) {backgroundcolor = Red3}; 
					if (diff > 1.50 && diff <= 2.00) {backgroundcolor = Pink1}; 
					if (diff > 2.00 && diff <= 2.50) {backgroundcolor = Purple1}; 			
					if (diff > 2.50) {backgroundcolor = White1};
					};
					
					if (BasinPlotType == 'QPE') {
					qpe = value;
					if (qpe > 0.00 && qpe < 0.10) {backgroundcolor = Cyan1}; 
					if (qpe >= 0.10 && qpe < 0.20) {backgroundcolor = Cyan2}; 
					if (qpe >= 0.20 && qpe < 0.40) {backgroundcolor = Blue1}; 
					if (qpe >= 0.40 && qpe < 0.60) {backgroundcolor = Green1};
					if (qpe >= 0.60 && qpe < 0.80) {backgroundcolor = Green2}; 
					if (qpe >= 0.80 && qpe < 1.00) {backgroundcolor = Green3}; 
					if (qpe >= 1.00 && qpe < 1.25) {backgroundcolor = Yellow1}; 
					if (qpe >= 1.25 && qpe < 1.50) {backgroundcolor = Orange1}; 
					if (qpe >= 1.50 && qpe < 1.75) {backgroundcolor = Orange2}; 
					if (qpe >= 1.75 && qpe < 2.00) {backgroundcolor = Red1}; 
					if (qpe >= 2.00 && qpe < 2.50) {backgroundcolor = Red2}; 
					if (qpe >= 2.50 && qpe < 3.00) {backgroundcolor = Red3}; 
					if (qpe >= 3.00 && qpe < 4.00) {backgroundcolor = Pink1}; 
					if (qpe >= 4.00 && qpe < 5.00) {backgroundcolor = Purple1}; 
					if (qpe >= 5.00) {backgroundcolor = White1};
					};
					
					if (BasinPlotType == 'FFG') {
					ffg = value;
					if (ffg > 0.00 && ffg < 0.10) {backgroundcolor = Cyan1}; 
					if (ffg >= 0.10 && ffg < 0.20) {backgroundcolor = Cyan2}; 
					if (ffg >= 0.20 && ffg < 0.40) {backgroundcolor = Blue1}; 
					if (ffg >= 0.40 && ffg < 0.60) {backgroundcolor = Green1};
					if (ffg >= 0.60 && ffg < 0.80) {backgroundcolor = Green2}; 
					if (ffg >= 0.80 && ffg < 1.00) {backgroundcolor = Green3}; 
					if (ffg >= 1.00 && ffg < 1.25) {backgroundcolor = Yellow1}; 
					if (ffg >= 1.25 && ffg < 1.50) {backgroundcolor = Orange1}; 
					if (ffg >= 1.50 && ffg < 1.75) {backgroundcolor = Orange2}; 
					if (ffg >= 1.75 && ffg < 2.00) {backgroundcolor = Red1}; 
					if (ffg >= 2.00 && ffg < 2.50) {backgroundcolor = Red2}; 
					if (ffg >= 2.50 && ffg < 3.00) {backgroundcolor = Red3}; 
					if (ffg >= 3.00 && ffg < 4.00) {backgroundcolor = Pink1}; 
					if (ffg >= 4.00 && ffg < 5.00) {backgroundcolor = Purple1}; 
					if (ffg >= 5.00) {backgroundcolor = White1};
					};		
			//console.log("backgroundcolor=" + backgroundcolor);
			return backgroundcolor;
		};
				
		//Zoom to Feature Function
		function ZoomToSelection(featurelayer){
			  graphics = new esri.Graphic();
			  var taxLotExtent;
		  graphics = featurelayer.getSelectedFeatures();
			  taxLotExtent = graphics[0].geometry.getExtent();
		  map1.setExtent(taxLotExtent.expand(4));
		  map2.setExtent(taxLotExtent.expand(4));
		};
		
		//Function to Select Basin Feature
		function TableSelectBasin(BasinPFAF){
			if (typeof BasinPFAF != 'undefined'){
			var query1 = new Query();
			//console.log(BasinPFAF);
			query1.where = "PFAF_ID = '" + BasinPFAF + "'"; 
			query1.returnGeometry = true;
			SubBasins1.selectFeatures(query1, FeatureLayer.SELECTION_NEW)
			ZoomToSelection(SubBasins1);
			SubBasins2.selectFeatures(query1, FeatureLayer.SELECTION_NEW)
			ZoomToSelection(SubBasins2);
			};
		};
			
		//Build Basin Table
		function BuildBasinTable(ObsArray,BasinPlotType,resultItems,resultItemsReversed) {
		
		//console.debug(ObsArray);
		//console.log(ObsArray);
		
		for (x=1;x<=2;x++){
			//console.log("x=" + x);
			var myTableDiv = document.getElementById("BasinTable" + x)
			var table = document.createElement('TABLE')
			table.border = '0';
			table.id = 'bTable'+x;
			table.className = 'tablesorter';
			var tableHead = document.createElement('THEAD')
			table.appendChild(tableHead);

			var heading = new Array();
			heading[0] = "Basin Name"
			heading[1] = "QPE"
			heading[2] = "FFG"
			heading[3] = "Ratio"
			heading[4] = "Diff"
			
			//Setup BackgroundKeys and Sort ObsArray Based Upon BasinPlotType
			if (BasinPlotType == 'QPE'){BackgroundKey = 1};
			if (BasinPlotType == 'FFG'){BackgroundKey = 2};
			if (BasinPlotType == 'Ratio'){BackgroundKey = 3};
			if (BasinPlotType == 'Diff'){BackgroundKey = 4;};
			ObsArray.sort(function(a,b){
				return b[BackgroundKey] - a[BackgroundKey];
				});

			//TABLE COLUMNS
			var tr = document.createElement('TR');
			tableHead.appendChild(tr);
			for (i = 0; i < heading.length; i++) {
				var th = document.createElement('TH')
				if (i == 0){th.style.textAlign = "left";th.style.width = "60%";};
				if (i == 1){th.style.textAlign = "center";th.style.width = "10%";};
				if (i == 2){th.style.textAlign = "center";th.style.width = "10%";};
				if (i == 3){th.style.textAlign = "center";th.style.width = "10%";};
				if (i == 4){th.style.textAlign = "center";th.style.width = "10%";};	
				th.appendChild(document.createTextNode(heading[i]));
				tr.appendChild(th);
			}

			var tableBody = document.createElement('TBODY');
			table.appendChild(tableBody);

			//TABLE ROWS
			for (i = 0; i < ObsArray.length; i++) {
				var tr = document.createElement('TR');
				for (j = 0; j < ObsArray[i].length; j++) {
					var td = document.createElement('TD');
					td.style.backgroundColor = "#FBFCFC";
					td.style.border = "2px solid black";
					td.style.padding = "2px";
					value = ObsArray[i][j];
					BasinName = resultItems[ObsArray[i][0]];
					if (typeof BasinName != 'undefined' && BasinName.length > 1){
						//console.log(BasinName);

						//console.log(ObsArray[i][0] + ' ' + ObsArray[i][1] + ' ' + ObsArray[i][2] + ' ' + ObsArray[i][3] + ' ' + ObsArray[i][4]);
						if (j == BackgroundKey) {backgroundcolor = SetBasinColor(value,BasinPlotType);td.style.backgroundColor = backgroundcolor;td.style.color = "black";}
					
						if (j == 0){td.style.textAlign = "left";td.style.width = "60%";val = resultItems[value];td.style.backgroundColor = "#C7C7C8";};
						if (j == 1){td.style.textAlign = "center";td.style.width = "10%";val = Number(value).toFixed(2);};
						if (j == 2){td.style.textAlign = "center";td.style.width = "10%";val = Number(value).toFixed(2);td.style.backgroundColor = "#C7C7C8";};
						if (j == 3){td.style.textAlign = "center";td.style.width = "10%";val = Number(value).toFixed(1);val = val + "%";};
						if (j == 4){td.style.textAlign = "center";td.style.width = "10%";val = Number(value).toFixed(2);};					

						td.style.fontWeight = "900";
						td.style.fontSize = "large";
						td.appendChild(document.createTextNode(val));
						tr.appendChild(td)
					};
				}
				tableBody.appendChild(tr);
			}  
			myTableDiv.appendChild(table)
			
		cells = table.getElementsByTagName('TD');

		for (var i = 0, len = cells.length; i < len; i++) {
			cells[i].onclick = function () {
				//console.log(this.innerHTML);
				TableSelectBasin(resultItemsReversed[this.innerHTML]);
				/* if you know it's going to be numeric:
				console.log(parseInt(this.innerHTML),10);
				*/
			};
		}
		};
		$("#bTable1").tablesorter();
		$("#bTable2").tablesorter();
		};
		
		//Query SubBasins to get STREAMNAMEs
		var queryTask = new QueryTask("http://services2.arcgis.com/C8EMgrsFcRFL6LrL/ArcGIS/rest/services/" + CWA + "SubBasins/FeatureServer/0");
		var query = new Query();
		query.returnGeometry = true;
		query.outFields = ["PFAF_ID", "STREAMNAME"];
		function executeBasinLayerQuery(querydefinition) {
			resultItems = {};
			resultItemsReversed = {};
			if (querydefinition.length > 1){
			//console.log("QD =" + querydefinition)
			query.where = querydefinition;
			queryTask.execute(query, showResults);
			} else {
			BuildBasinTable(ObsArray,BasinPlotType,resultItems,resultItemsReversed);
			};
		};
		function showResults (results) {
			var resultCount = results.features.length;
			for (var i = 0; i < resultCount; i++) {
				var featureAttributes = results.features[i].attributes;
				id = featureAttributes["PFAF_ID"];
				hucname = featureAttributes["STREAMNAME"];
				//console.log(id + ' ' + hucname);
				resultItems[id] = hucname;
				resultItemsReversed[hucname] = id
			};

		BuildBasinTable(ObsArray,BasinPlotType,resultItems,resultItemsReversed);
		};
		
		//Function to initiate Basin Alert if not already alerted
		var RiverAlertTrigger1 = false;
		function RiverAlert(WorstCaseStage,WorstCaseStageName){		
		console.log("WorstCastStage and Site ID/NAME: " + WorstCaseStage + ' ' + WorstCaseStageName);
		if (WorstCaseStage != 'Normal' && RiverAlertTrigger1 == false){
			//Sound Alarm
			console.log("Sounding Alarm on " + WorstCaseStageName + " for " + WorstCaseStage + " stage");
			document.getElementById('RiverAlertAudio1').play();
			setTimeout(function(){ alert("Check your " + WorstCaseStageName + " stream levels, partner!"); }, 3000);
			RiverAlertTrigger1 = true;
		};
		if (WorstCaseStage == 'Normal'){
		RiverAlertTrigger1 = false;
		};
		};
		
		//Build River Table
		function BuildRiverTable() {
	
		var RiverObsArray = [];
		$.get(DataDir + "riverquery.csv", function( txt ) {
		counter = 0;
		var Riverdata = txt.split('\n');
		for (var i = 1; i < Riverdata.length - 1; i++) {
		var currentline = Riverdata[i];
		currentline = currentline.split(',');
		var siteid = currentline[0];
		var location = currentline[14];
		var currentlevel = currentline[3];
		var actionstage = currentline[8];
		var minorfloodstage = currentline[9];
		var moderatefloodstage = currentline[10];
		var majorfloodstage = currentline[11];
		var stagecat = currentline[12];
		var fldstgdeparture = currentlevel - minorfloodstage
		fldstgdeparture = Number(fldstgdeparture).toFixed(2)
		var county = currentline[15];
		RiverObsArray[counter] = new Array(siteid + ": " + location, currentlevel, fldstgdeparture, actionstage, minorfloodstage, moderatefloodstage, majorfloodstage, stagecat, county);
		counter = counter + 1;
		};
		
		//console.debug(RiverObsArray);
		
		//Sort RiverObsArray Based Upon Upgrade Departure
		var SortKey = 2;
		RiverObsArray.sort(function(a,b){
			return b[SortKey] - a[SortKey];
			});
		
		HighestThreatName = RiverObsArray[0][0];
		HighestThreat = RiverObsArray[0][7];

		for (x=1;x<=2;x++){
			//console.log("x=" + x);
			var myTableDiv = document.getElementById("RiverTable" + x);
			//myTableDiv.className = "RiverTable" + x;
			var table = document.createElement('TABLE');

			table.border = '0';
			table.id = 'rTable'+x;
			table.className = 'tablesorter';
			var tableHead = document.createElement('THEAD');
			table.appendChild(tableHead);

			var heading = new Array();
			heading[0] = "Stream Name"
			heading[1] = "County"
			heading[2] = "<span style='background-color:yellow'>Ac</span>/<span style='background-color:orange'>Mi</span>/<span style='background-color:red'>Mo</span>/<span style='background-color:magenta'>Ma</span>"
			heading[3] = "Current Level"
			heading[4] = "Flood Stg Departure"
			
			//TABLE COLUMNS
			var tr = document.createElement('TR');
			tableHead.appendChild(tr);
			for (i = 0; i < heading.length; i++) {
				var th = document.createElement('TH')
				if (i == 0){th.style.textAlign = "left";th.style.width = "31%";};
				if (i == 1){th.style.textAlign = "center";th.style.width = "12%";};
				if (i == 2){th.style.textAlign = "center";th.style.width = "15%";};
				if (i == 3){th.style.textAlign = "center";th.style.width = "12%";};
				if (i == 4){th.style.textAlign = "center";th.style.width = "12%";};	
				if (i == 5){th.style.textAlign = "center";th.style.width = "12%";};	
				if (i == 6){th.style.textAlign = "center";th.style.width = "12%";};	
				//th.appendChild(document.createTextNode(heading[i]));
				th.insertAdjacentHTML('beforeend',heading[i]);
				tr.appendChild(th);
			}

			var tableBody = document.createElement('TBODY');
			table.appendChild(tableBody);

			//TABLE ROWS
			for (i = 0; i < RiverObsArray.length; i++) {
				var tr = document.createElement('TR');
				if (i === 100) { break; }
				for (j = 0; j < heading.length; j++) {
					var td = document.createElement('TD');
					td.style.backgroundColor = "#FBFCFC";
					td.style.border = "2px solid black";
					td.style.padding = "2px";
					//console.log(RiverObsArray[i]);
					if ( j == 1 ) {
						//county 
						value = RiverObsArray[i][8];
                                        } else if ( j == 2 ) {
						//states
						value = RiverObsArray[i][3]+'/'+RiverObsArray[i][4]+'/'+RiverObsArray[i][5]+'/'+RiverObsArray[i][6];
                                        } else if ( j == 3 ) {
						//current level
						value = RiverObsArray[i][1];
                                        } else if ( j == 4 ) {
						//current departure
						value = RiverObsArray[i][2];
					}
                                        else {
					  value = RiverObsArray[i][j];
                                        }
					siteid = RiverObsArray[i][0];
					siteid = siteid.split(":");
					siteid = siteid[0];
					stagecategory = RiverObsArray[i][7];
					//console.log(stagecategory);
										
					var CurrentStageBackgroundKey = "";
					if (stagecategory === 'Normal') {
					CurrentStageBackgroundColor = "#FBFCFC";
					} else {
					if (stagecategory === 'Action') {CurrentStageBackgroundColor = Yellow;CurrentStageBackgroundKey = 3;};
					if (stagecategory === 'Minor') {CurrentStageBackgroundColor = Orange;CurrentStageBackgroundKey = 3;};
					if (stagecategory === 'Moderate') {CurrentStageBackgroundColor = Red;CurrentStageBackgroundKey = 3;};
					if (stagecategory === 'Major') {CurrentStageBackgroundColor = Magenta;CurrentStageBackgroundKey = 3;};
					};
		
					//RiverObsArray[counter] = new Array(siteid + ": " + location, currentlevel, fldstgdeparture, actionstage, minorfloodstage, moderatefloodstage, majorfloodstage, stagecat, county);
					
					// Set CurrentStage Color
					if (j == CurrentStageBackgroundKey) {td.style.backgroundColor = CurrentStageBackgroundColor;td.style.color = "black";}
					
					if (j == 0){td.style.textAlign = "left";td.style.width = "31%";val = value;td.style.backgroundColor = "#C7C7C8";};
					if (j == 1){td.style.textAlign = "center";td.style.width = "12%";val = value;td.style.backgroundColor = "#C7C7C8";};
					if (j == 2){td.style.textAlign = "center";td.style.width = "15%";val = value;};
					if (j == 3){td.style.backgroundColor = CurrentStageBackgroundColor;td.style.color = "black";td.style.textAlign = "center";td.style.width = "12%";val = Number(value).toFixed(2);};
					if (j == 4){td.style.backgroundColor = CurrentStageBackgroundColor;td.style.color = "black";td.style.textAlign = "center";td.style.width = "12%";val = Number(value).toFixed(2);};

					td.style.fontWeight = "900";
					td.style.fontSize = "large";
					td.appendChild(document.createTextNode(val));
					
					
					// Add listener for popup on column 0
					if (j == 0){
					var img = document.createElement('img');
					var url = "http://water.weather.gov/resources/hydrographs/" + siteid.toLowerCase() + "_hg.png?"+new Date().getTime();
					img.src = url;
					td.appendChild(img);				
					};
					tr.appendChild(td)
				}
				tableBody.appendChild(tr);
			}  
			myTableDiv.appendChild(table)
			
		cells = table.getElementsByTagName('TD');
		
		};
		
		RiverAlert(HighestThreat,HighestThreatName);
		$("#rTable1").tablesorter();
		$("#rTable2").tablesorter();

		});
		};			

		//Slider Bar to Filter Above Precipitation CSV Layers
		$(function() {
			$( "#slider" ).slider({
			value:0,
			min: 0,
			max: 2,
			step: 0.10,
			slide: function( event, ui ) {
			//console.log("FILTERVALUE: " + ui.value);
			FILTERVALUE = ui.value;
			if (FILTERVALUE == 0.00){LABEL = 'Showing Precip > 0.00"';}
			if (FILTERVALUE == 0.10){LABEL = 'Showing Precip >= 0.10"';}
			if (FILTERVALUE == 0.20){LABEL = 'Showing Precip >= 0.20"';}
			if (FILTERVALUE == 0.30){LABEL = 'Showing Precip >= 0.30"';}
			if (FILTERVALUE == 0.40){LABEL = 'Showing Precip >= 0.40"';}
			if (FILTERVALUE == 0.50){LABEL = 'Showing Precip >= 0.50"';}
			if (FILTERVALUE == 0.60){LABEL = 'Showing Precip >= 0.60"';}
			if (FILTERVALUE == 0.70){LABEL = 'Showing Precip >= 0.70"';}
			if (FILTERVALUE == 0.80){LABEL = 'Showing Precip >= 0.80"';}
			if (FILTERVALUE == 0.90){LABEL = 'Showing Precip >= 0.90"';}
			if (FILTERVALUE == 1.00){LABEL = 'Showing Precip >= 1.00"';}
			if (FILTERVALUE == 1.10){LABEL = 'Showing Precip >= 1.10"';}
			if (FILTERVALUE == 1.20){LABEL = 'Showing Precip >= 1.20"';}
			if (FILTERVALUE == 1.30){LABEL = 'Showing Precip >= 1.30"';}
			if (FILTERVALUE == 1.40){LABEL = 'Showing Precip >= 1.40"';}
			if (FILTERVALUE == 1.50){LABEL = 'Showing Precip >= 1.50"';}
			if (FILTERVALUE == 1.60){LABEL = 'Showing Precip >= 1.60"';}
			if (FILTERVALUE == 1.70){LABEL = 'Showing Precip >= 1.70"';}
			if (FILTERVALUE == 1.80){LABEL = 'Showing Precip >= 1.80"';}
			if (FILTERVALUE == 1.90){LABEL = 'Showing Precip >= 1.90"';}
			if (FILTERVALUE == 2.00){LABEL = 'Showing Precip >= 2.00"';}
			// console.log("LABEL: " + LABEL);
			$("#label").html(LABEL);
			CSVVALUE = FILTERVALUE;
				}
			});
		});	
		
		
		//Function to initiate Basin Alert if not already alerted
		var BasinAlertTrigger100 = false;
		var BasinAlertTrigger150 = false;
		function BasinAlert(WorstCaseRatio,WorstCaseRatioTime){
		if (WorstCaseRatio >= 100 && WorstCaseRatio < 150 && BasinAlertTrigger100 == false){
			//Sound Alarm
			console.log("Sounding Alarm on " + WorstCaseRatio + "%");
			document.getElementById('BasinAlertAudio1').play();
			setTimeout(function(){ alert("Check your " + WorstCaseRatioTime + " worst case basins, partner!"); }, 3000);
			//alert("Check Your " + WorstCaseRatioTime + " Basins");
			BasinAlertTrigger100 = true;
		};
		
		if (WorstCaseRatio >= 150 && BasinAlertTrigger150 == false){
			//Sound Alarm
			console.log("Sounding Alarm on " + WorstCaseRatio + "%");
			document.getElementById('BasinAlertAudio2').play();
			setTimeout(function(){ alert("Check your " + WorstCaseRatioTime + " worst case basins, partner!"); }, 3000);
			//alert("Check Your " + WorstCaseRatioTime + " Basins");
			BasinAlertTrigger150 = true;
		};		
		
		if (WorstCaseRatio < 100 && BasinAlertTrigger100 == true){
			BasinAlertTrigger100 = false;
		};
		if (WorstCaseRatio < 150 && BasinAlertTrigger150 == true){
			BasinAlertTrigger150 = false;
		};
		};	
		
		//Read in PrecipAnalysisStats csv file
		var OverallTopPerformer;
		var OverallBottomPerformer;
		function GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE){
		$.get(DataDir + "PrecipAnalysisStats.csv", function( txt ) {
				var data = txt.split('\r\n');
				ValidTimeLine = data[0];
				UpdateValidTime(ValidTimeLine);
				//console.log(ValidTimeLine + ' is Valid Time');
				//console.log(OldValidTimeLine + ' is Last Valid Time OUT');
				TopPerformerLine = data[1];
				TopPerformerLine = TopPerformerLine.split(',');
				
				//Get Worst Case Ratio Data
				WorstCaseRatioData = data[2];
				WorstCaseRatioData  = WorstCaseRatioData.split(',');
				WorstCaseRatio = WorstCaseRatioData[0];
				WorstCaseRatioTime = WorstCaseRatioData[1];
				BasinAlert(WorstCaseRatio,WorstCaseRatioTime);
				
				//Get SmartBlend Attributes
				SmartBlend30 = data[3];
				SmartBlend60 = data[4];
				SmartBlend120 = data[5];
				SmartBlend180 = data[6];
				SmartBlend360 = data[7];
				
				if (selectedlayer == '30min'){OverallTopPerformer = TopPerformerLine[0];OverallBottomPerformer = TopPerformerLine[5];setSmartBlendAttributes(SmartBlend30)};
				if (selectedlayer == '60min'){OverallTopPerformer = TopPerformerLine[1];OverallBottomPerformer = TopPerformerLine[6];setSmartBlendAttributes(SmartBlend60)};
				if (selectedlayer == '120min'){OverallTopPerformer = TopPerformerLine[2];OverallBottomPerformer = TopPerformerLine[7];setSmartBlendAttributes(SmartBlend120)};
				if (selectedlayer == '180min'){OverallTopPerformer = TopPerformerLine[3];OverallBottomPerformer = TopPerformerLine[8];setSmartBlendAttributes(SmartBlend180)};
				if (selectedlayer == '360min'){OverallTopPerformer = TopPerformerLine[4];OverallBottomPerformer = TopPerformerLine[9];setSmartBlendAttributes(SmartBlend360)};
				//console.log(OverallTopPerformer);
				ChangeBasinSourceButtons(BasinPlotSource,OverallTopPerformer,OverallBottomPerformer);
				DrawBasins(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE,OverallTopPerformer);
				WorstCaseRatioData = data[2];
				WorstCaseRatioData  = WorstCaseRatioData.split(',');
				WorstCaseRatio = WorstCaseRatioData[0];
				WorstCaseRatioTime = WorstCaseRatioData[1];
				BasinAlert(WorstCaseRatio,WorstCaseRatioTime);
				
				
				//OldValidTimeLine = OldVT;
				//console.log(OldValidTimeLine + ' is Last Valid Time IN');
				
		});
		};
		
		function refreshBasins(layerDefs){
		if (layerDefs.length < 1){layerDefs = "PFAF_ID IS NULL"};
		//console.log("LayerDefs:" + layerDefs);
		var box1 = document.getElementById("Basins1");
		var box2 = document.getElementById("Basins2");
		if (box1.checked == true && box2.checked == true){SubBasins1.setDefinitionExpression(layerDefs);SubBasins2.setDefinitionExpression(layerDefs);SubBasins1.setRenderer(Basinrenderer);SubBasins2.setRenderer(Basinrenderer);SubBasins1.refresh();SubBasins2.refresh();};
		if (box1.checked == true && box2.checked == false){SubBasins1.setDefinitionExpression(layerDefs);SubBasins1.setRenderer(Basinrenderer);SubBasins1.refresh();};
		if (box1.checked == false && box2.checked == true){SubBasins2.setDefinitionExpression(layerDefs);SubBasins2.setRenderer(Basinrenderer);SubBasins2.refresh();};
		//if (box1.checked == true && box2.checked == true){SubBasins1.setDefinitionExpression(layerDefs);SubBasins2.setDefinitionExpression(layerDefs);SubBasins1.setRenderer(Basinrenderer);SubBasins2.setRenderer(Basinrenderer);};
		//if (box1.checked == true && box2.checked == false){SubBasins1.setDefinitionExpression(layerDefs);SubBasins1.setRenderer(Basinrenderer);};
		//if (box1.checked == false && box2.checked == true){SubBasins2.setDefinitionExpression(layerDefs);SubBasins2.setRenderer(Basinrenderer);};
		//console.log("WE MADE IT!");
		};

		function DrawBasins(selectedlayer,BasinPlotTypealt,BasinPlotSourcealt,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE,OverallTopPerformer) {
			console.log("   ");
			SubBasins1.clearSelection();
			map1.infoWindow.hide();
			SubBasins2.clearSelection();
			map2.infoWindow.hide();
			var layerDefs = [];
			var counter = 0;
			basintable = {};
			BasinPlotType = BasinPlotTypealt;
			//BasinqpeFilterVALUE = 0.10;
			//BasinDiffFilterVALUE = -5.00;
			//BasinRatioFilterVALUE = 0.01;
			var BasinLimit = 1000;
			
			console.log("BasinRatioFilterVALUE: " + BasinRatioFilterVALUE);
			console.log("BasinDiffFilterVALUE: " + BasinDiffFilterVALUE);
			console.log("BasinqpeFilterVALUE: " + BasinqpeFilterVALUE);
			
			//console.log("Selected Plot Source: " + BasinPlotSourcealt);
			if (BasinPlotSourcealt == "TopPerformer"){BasinPlotSource = OverallTopPerformer;} else {BasinPlotSource = BasinPlotSourcealt;};
			//console.log("Final Plot Source: " + BasinPlotSource);
			
			LoadQPEImage(selectedlayer,BasinPlotSource);
		
			$.get(DataDir + "PrecipAnalysis.csv", function( txt ) {
			
				// function GetRatio(qpe,ffg) {
				// // console.log(qpe + ';' + ffg);
				// rawratio = 100 * (qpe/ffg);
				// return rawratio;
				// };
				
				//Reset ObsArray for BasinTable
				ObsArray = [];
			
				var data = txt.split('\r\n');
				for (var i = 0; i < data.length - 1; i++) {
					if (counter < BasinLimit) {
					var currentline = data[i];
					// console.log(currentline);
					currentline = currentline.split(',');
					if (selectedlayer == '30min'){
					basinID = currentline[0].split(".");
					basinID = basinID[0];
					ffg = currentline[1];
					bestsource = currentline[101];
					worstsource = currentline[81];
					wsr88dsource  = currentline[151];
					if (BasinPlotSource == 'MRMS'){qpe = currentline[6];ratio = currentline[11];diff = currentline[16];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DHR'){qpe = currentline[21];ratio = currentline[26];diff = currentline[31];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DPR'){qpe = currentline[36];ratio = currentline[41];diff = currentline[46];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'HPE'){qpe = currentline[51];ratio = currentline[56];diff = currentline[61];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BHPE'){qpe = currentline[66];ratio = currentline[71];diff = currentline[76];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'WorstCase'){qpe = currentline[86];ratio = currentline[91];diff = currentline[96];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BestCase'){qpe = currentline[106];ratio = currentline[111];diff = currentline[116];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'AllBlend'){qpe = currentline[121];ratio = currentline[126];diff = currentline[131];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'SmartBlend'){qpe = currentline[136];ratio = currentline[141];diff = currentline[146];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					
					};
					if (selectedlayer == '60min'){
					basinID = currentline[0].split(".");
					basinID = basinID[0];
					ffg = currentline[2];
					bestsource = currentline[102];
					worstsource = currentline[82];
					wsr88dsource  = currentline[151];
					if (BasinPlotSource == 'MRMS'){qpe = currentline[7];ratio = currentline[12];diff = currentline[17];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DHR'){qpe = currentline[22];ratio = currentline[27];diff = currentline[32];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DPR'){qpe = currentline[37];ratio = currentline[42];diff = currentline[47];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'HPE'){qpe = currentline[52];ratio = currentline[57];diff = currentline[62];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BHPE'){qpe = currentline[67];ratio = currentline[72];diff = currentline[77];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'WorstCase'){qpe = currentline[87];ratio = currentline[92];diff = currentline[97];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BestCase'){qpe = currentline[107];ratio = currentline[112];diff = currentline[117];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'AllBlend'){qpe = currentline[122];ratio = currentline[127];diff = currentline[132];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'SmartBlend'){qpe = currentline[137];ratio = currentline[142];diff = currentline[147];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					
					
					};
					if (selectedlayer == '120min'){
					basinID = currentline[0].split(".");
					basinID = basinID[0];
					ffg = currentline[3];
					bestsource = currentline[103];
					worstsource = currentline[83];
					wsr88dsource  = currentline[151];
					if (BasinPlotSource == 'MRMS'){qpe = currentline[8];ratio = currentline[13];diff = currentline[18];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DHR'){qpe = currentline[23];ratio = currentline[28];diff = currentline[33];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DPR'){qpe = currentline[38];ratio = currentline[43];diff = currentline[48];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'HPE'){qpe = currentline[53];ratio = currentline[58];diff = currentline[63];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BHPE'){qpe = currentline[68];ratio = currentline[73];diff = currentline[78];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'WorstCase'){qpe = currentline[88];ratio = currentline[93];diff = currentline[98];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BestCase'){qpe = currentline[108];ratio = currentline[113];diff = currentline[118];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'AllBlend'){qpe = currentline[123];ratio = currentline[128];diff = currentline[133];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'SmartBlend'){qpe = currentline[138];ratio = currentline[143];diff = currentline[148];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					
					};
					if (selectedlayer == '180min'){
					basinID = currentline[0].split(".");
					basinID = basinID[0];
					ffg = currentline[4];
					bestsource = currentline[104];
					worstsource = currentline[84];
					wsr88dsource  = currentline[151];
					if (BasinPlotSource == 'MRMS'){qpe = currentline[9];ratio = currentline[14];diff = currentline[19];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DHR'){qpe = currentline[24];ratio = currentline[29];diff = currentline[34];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DPR'){qpe = currentline[39];ratio = currentline[44];diff = currentline[49];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'HPE'){qpe = currentline[54];ratio = currentline[59];diff = currentline[64];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BHPE'){qpe = currentline[69];ratio = currentline[74];diff = currentline[79];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'WorstCase'){qpe = currentline[89];ratio = currentline[94];diff = currentline[99];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BestCase'){qpe = currentline[109];ratio = currentline[114];diff = currentline[119];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'AllBlend'){qpe = currentline[124];ratio = currentline[129];diff = currentline[134];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'SmartBlend'){qpe = currentline[139];ratio = currentline[144];diff = currentline[149];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					
					};
					if (selectedlayer == '360min'){
					basinID = currentline[0].split(".");
					basinID = basinID[0];
					ffg = currentline[5];
					bestsource = currentline[105];
					worstsource = currentline[85];
					wsr88dsource  = currentline[151];
					if (BasinPlotSource == 'MRMS'){qpe = currentline[10];ratio = currentline[15];diff = currentline[20];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DHR'){qpe = currentline[25];ratio = currentline[30];diff = currentline[35];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'DPR'){qpe = currentline[40];ratio = currentline[45];diff = currentline[50];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'HPE'){qpe = currentline[55];ratio = currentline[60];diff = currentline[65];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BHPE'){qpe = currentline[70];ratio = currentline[75];diff = currentline[80];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'WorstCase'){qpe = currentline[90];ratio = currentline[95];diff = currentline[100];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'BestCase'){qpe = currentline[110];ratio = currentline[115];diff = currentline[120];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'AllBlend'){qpe = currentline[125];ratio = currentline[130];diff = currentline[135];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					if (BasinPlotSource == 'SmartBlend'){qpe = currentline[140];ratio = currentline[145];diff = currentline[150];basintable[basinID] = ratio + ':' + diff + ':' + qpe + ':' + ffg + ':' + bestsource + ':' + worstsource + ':' + wsr88dsource;};
					
					};
					
					
					if (BasinPlotType == 'Ratio') {
					if (ratio == 0.00) {Basinrenderer.addValue(basinID, sfsClear0);};
					if (ratio > 0.00 && ratio < 5.00) {Basinrenderer.addValue(basinID, sfsCyan0);};
					if (ratio >= 5.00 && ratio < 10.00) {Basinrenderer.addValue(basinID, sfsCyan1);}; 
					if (ratio >= 10.00 && ratio < 20.00) {Basinrenderer.addValue(basinID, sfsCyan2);}; 
					if (ratio >= 20.00 && ratio < 30.00) {Basinrenderer.addValue(basinID, sfsBlue1);}; 
					if (ratio >= 30.00 && ratio < 40.00) {Basinrenderer.addValue(basinID, sfsGreen1);};
					if (ratio >= 40.00 && ratio < 50.00) {Basinrenderer.addValue(basinID, sfsGreen2);}; 
					if (ratio >= 50.00 && ratio < 60.00) {Basinrenderer.addValue(basinID, sfsGreen3);}; 
					if (ratio >= 60.00 && ratio < 70.00) {Basinrenderer.addValue(basinID, sfsYellow1);}; 
					if (ratio >= 70.00 && ratio < 75.00) {Basinrenderer.addValue(basinID, sfsOrange1);};
					if (ratio >= 75.00 && ratio < 80.00) {Basinrenderer.addValue(basinID, sfsOrange2);}; 
					if (ratio >= 80.00 && ratio < 85.00) {Basinrenderer.addValue(basinID, sfsRed1);}; 
					if (ratio >= 85.00 && ratio < 90.00) {Basinrenderer.addValue(basinID, sfsRed2);}; 
					if (ratio >= 90.00 && ratio < 95.00) {Basinrenderer.addValue(basinID, sfsRed3);}; 
					if (ratio >= 95.00 && ratio < 100.00) {Basinrenderer.addValue(basinID, sfsPink1);}; 
					if (ratio >= 100.00 && ratio < 200.00) {Basinrenderer.addValue(basinID, sfsPurple1);}; 			
					if (ratio >= 200.00) {Basinrenderer.addValue(basinID, sfsWhite1);};
					if (ratio >= BasinRatioFilterVALUE && ratio >= 1.00){
					layerDefs[counter] = 'PFAF_ID=' + basinID;
					ObsArray[counter] = new Array(basinID, qpe, ffg, ratio, diff)
					counter = counter + 1;
					//console.log(basinID, qpe, ffg, ratio, diff);
					};
					};
					
					if (BasinPlotType == 'Diff') {
					if (diff > -3.00 && diff < -2.50) {Basinrenderer.addValue(basinID, sfsCyan1);}; 
					if (diff >= -2.50 && diff < -2.00) {Basinrenderer.addValue(basinID, sfsCyan2);}; 
					if (diff >= -2.00 && diff < -1.50) {Basinrenderer.addValue(basinID, sfsBlue1);};
					if (diff >= -1.50 && diff < -1.00) {Basinrenderer.addValue(basinID, sfsGreen1);};
					if (diff >= -1.00 && diff < -0.75) {Basinrenderer.addValue(basinID, sfsGreen2);}; 
					if (diff >= -0.75 && diff < -0.50) {Basinrenderer.addValue(basinID, sfsGreen3);}; 
					if (diff >= -0.50 && diff < -0.25) {Basinrenderer.addValue(basinID, sfsYellow1);}; 
					if (diff >= -0.25 && diff < 0.25) {Basinrenderer.addValue(basinID, sfsOrange1);};
					if (diff >= 0.25 && diff < 0.50) {Basinrenderer.addValue(basinID, sfsOrange2);}; 
					if (diff >= 0.50 && diff < 0.75) {Basinrenderer.addValue(basinID, sfsRed1);}; 
					if (diff >= 0.75 && diff < 1.00) {Basinrenderer.addValue(basinID, sfsRed2);}; 
					if (diff >= 1.00 && diff < 1.50) {Basinrenderer.addValue(basinID, sfsRed3);}; 
					if (diff >= 1.50 && diff < 2.00) {Basinrenderer.addValue(basinID, sfsPink1);}; 
					if (diff >= 2.00 && diff < 2.50) {Basinrenderer.addValue(basinID, sfsPurple1);}; 			
					if (diff >= 2.50) {Basinrenderer.addValue(basinID, sfsWhite1);};
					if (diff >= BasinDiffFilterVALUE && diff >= -2.50){
					layerDefs[counter] = 'PFAF_ID=' + basinID;
					ObsArray[counter] = new Array(basinID, qpe, ffg, ratio, diff)
					counter = counter + 1;
					};
					};
					
					if (BasinPlotType == 'QPE') {
					if (qpe > 0.00 && qpe < 0.10) {Basinrenderer.addValue(basinID, sfsCyan1);}; 
					if (qpe >= 0.10 && qpe < 0.20) {Basinrenderer.addValue(basinID, sfsCyan2);}; 
					if (qpe >= 0.20 && qpe < 0.40) {Basinrenderer.addValue(basinID, sfsBlue1);}; 
					if (qpe >= 0.40 && qpe < 0.60) {Basinrenderer.addValue(basinID, sfsGreen1);};
					if (qpe >= 0.60 && qpe < 0.80) {Basinrenderer.addValue(basinID, sfsGreen2);}; 
					if (qpe >= 0.80 && qpe < 1.00) {Basinrenderer.addValue(basinID, sfsGreen3);}; 
					if (qpe >= 1.00 && qpe < 1.25) {Basinrenderer.addValue(basinID, sfsYellow1);}; 
					if (qpe >= 1.25 && qpe < 1.50) {Basinrenderer.addValue(basinID, sfsOrange1);}; 
					if (qpe >= 1.50 && qpe < 1.75) {Basinrenderer.addValue(basinID, sfsOrange2);}; 
					if (qpe >= 1.75 && qpe < 2.00) {Basinrenderer.addValue(basinID, sfsRed1);}; 
					if (qpe >= 2.00 && qpe < 2.50) {Basinrenderer.addValue(basinID, sfsRed2);}; 
					if (qpe >= 2.50 && qpe < 3.00) {Basinrenderer.addValue(basinID, sfsRed3);}; 
					if (qpe >= 3.00 && qpe < 4.00) {Basinrenderer.addValue(basinID, sfsPink1);}; 
					if (qpe >= 4.00 && qpe < 5.00) {Basinrenderer.addValue(basinID, sfsPurple1);}; 
					if (qpe >= 5.00) {Basinrenderer.addValue(basinID, sfsWhite1);};
					if (qpe >= BasinqpeFilterVALUE && qpe >= 0.01){
					layerDefs[counter] = 'PFAF_ID=' + basinID;
					ObsArray[counter] = new Array(basinID, qpe, ffg, ratio, diff)
					counter = counter + 1;
					};
					};
					
					if (BasinPlotType == 'FFG') {
					if (ffg > 0.00 && ffg < 0.10) {Basinrenderer.addValue(basinID, sfsCyan1);}; 
					if (ffg >= 0.10 && ffg < 0.20) {Basinrenderer.addValue(basinID, sfsCyan2);}; 
					if (ffg >= 0.20 && ffg < 0.40) {Basinrenderer.addValue(basinID, sfsBlue1);}; 
					if (ffg >= 0.40 && ffg < 0.60) {Basinrenderer.addValue(basinID, sfsGreen1);};
					if (ffg >= 0.60 && ffg < 0.80) {Basinrenderer.addValue(basinID, sfsGreen2);}; 
					if (ffg >= 0.80 && ffg < 1.00) {Basinrenderer.addValue(basinID, sfsGreen3);}; 
					if (ffg >= 1.00 && ffg < 1.25) {Basinrenderer.addValue(basinID, sfsYellow1);}; 
					if (ffg >= 1.25 && ffg < 1.50) {Basinrenderer.addValue(basinID, sfsOrange1);}; 
					if (ffg >= 1.50 && ffg < 1.75) {Basinrenderer.addValue(basinID, sfsOrange2);}; 
					if (ffg >= 1.75 && ffg < 2.00) {Basinrenderer.addValue(basinID, sfsRed1);}; 
					if (ffg >= 2.00 && ffg < 2.50) {Basinrenderer.addValue(basinID, sfsRed2);}; 
					if (ffg >= 2.50 && ffg < 3.00) {Basinrenderer.addValue(basinID, sfsRed3);}; 
					if (ffg >= 3.00 && ffg < 4.00) {Basinrenderer.addValue(basinID, sfsPink1);}; 
					if (ffg >= 4.00 && ffg < 5.00) {Basinrenderer.addValue(basinID, sfsPurple1);}; 
					if (ffg >= 5.00) {Basinrenderer.addValue(basinID, sfsWhite1);};
					layerDefs[counter] = 'PFAF_ID=' + basinID;
					ObsArray[counter] = new Array(basinID, qpe, ffg, ratio, diff)
					counter = counter + 1;
					};				
					};
				};
				
				
				//Increment Filter Up
				if (counter >= BasinLimit && AutoFilterTrigger == true){
					if (BasinRatioFilterVALUE != 50.00){
					DrawBasinsWrapper(BasinRatioFilterVALUE + 5,"#slider2",BasinPlotSourcealt);
					};
				};
				
				//Increment Filter Down
				//if (counter < BasinLimit && AutoFilterTrigger == true){
				//	if (BasinRatioFilterVALUE != 0.00){
				//	DrawBasinsWrapper(0,"#slider2",BasinPlotSourcealt);
				//	changetriggerDOWN = true;
				//	};
				//};
				
				//Draw Basins
				if (counter >= BasinLimit && AutoFilterTrigger == false){
					alert("Basin drawing limit exceeded, please increase basin filtering OR activate Auto Filtering");
				};

				if (counter < BasinLimit || BasinRatioFilterVALUE == 50.00){
					//console.log("Counter=" + counter);
					BasinPlotSource = BasinPlotSourcealt;
					layerDefs = layerDefs.join(" OR ");
					document.getElementById("BasinTable1").innerHTML = "";
					document.getElementById("BasinTable2").innerHTML = "";
					executeBasinLayerQuery(layerDefs);
					refreshBasins(layerDefs);
				};
			});
		// SubBasins.setDefinitionExpression(layerDefs);
		// console.log(BasinPlotType);
		// console.log(BasinPlotSource);
		
		};	
		
		function ResetSlider2(){
			FILTERVALUE = 0;
			$('#slider2').slider( "value", FILTERVALUE);
			if (FILTERVALUE == 0.0){BasinDiffFilterVALUE = -2.50;BasinqpeFilterVALUE = 0.00;LABEL = 'Showing Ratio|Diff|QPE >= 1%|-2.50|0.01"';}
			$("#label2").html(LABEL);
			BasinRatioFilterVALUE = FILTERVALUE;
			};
		
		function DrawBasinsWrapper(FILTERVALUE,sliderID,BasinPlotSourcealt){
		
			if (sliderID == '#slider2'){
			$(sliderID).slider( "value", FILTERVALUE);
			console.log("FILTERVALUE: " + FILTERVALUE);
			if (FILTERVALUE == 0.0){BasinDiffFilterVALUE = -2.50;BasinqpeFilterVALUE = 0.00;LABEL = 'Showing Ratio|Diff|QPE >= 1%|-2.50|0.01"';}
			if (FILTERVALUE == 5.0){BasinDiffFilterVALUE = -2.25;BasinqpeFilterVALUE = 0.10;LABEL = 'Showing Ratio|Diff|QPE >= 5%|-2.25|0.10"';}
			if (FILTERVALUE == 10.0){BasinDiffFilterVALUE = -2.00;BasinqpeFilterVALUE = 0.20;LABEL = 'Showing Ratio|Diff|QPE >= 10%|-2.00|0.20"';}
			if (FILTERVALUE == 15.0){BasinDiffFilterVALUE = -1.75;BasinqpeFilterVALUE = 0.30;LABEL = 'Showing Ratio|Diff|QPE >= 15%|-1.75|0.30"';}
			if (FILTERVALUE == 20.0){BasinDiffFilterVALUE = -1.50;BasinqpeFilterVALUE = 0.40;LABEL = 'Showing Ratio|Diff|QPE >= 20%|-1.50|0.40"';}
			if (FILTERVALUE == 25.0){BasinDiffFilterVALUE = -1.25;BasinqpeFilterVALUE = 0.50;LABEL = 'Showing Ratio|Diff|QPE >= 25%|-1.25|0.50"';}
			if (FILTERVALUE == 30.0){BasinDiffFilterVALUE = -1.00;BasinqpeFilterVALUE = 0.60;LABEL = 'Showing Ratio|Diff|QPE >= 30%|-1.00|0.60"';}
			if (FILTERVALUE == 35.0){BasinDiffFilterVALUE = -0.75;BasinqpeFilterVALUE = 0.70;LABEL = 'Showing Ratio|Diff|QPE >= 35%|-0.75|0.70"';}
			if (FILTERVALUE == 40.0){BasinDiffFilterVALUE = -0.50;BasinqpeFilterVALUE = 0.80;LABEL = 'Showing Ratio|Diff|QPE >= 40%|-0.50|0.80"';}
			if (FILTERVALUE == 45.0){BasinDiffFilterVALUE = -0.25;BasinqpeFilterVALUE = 0.90;LABEL = 'Showing Ratio|Diff|QPE >= 45%|-0.25|0.90"';}
			if (FILTERVALUE == 50.0){BasinDiffFilterVALUE = -0.00;BasinqpeFilterVALUE = 1.00;LABEL = 'Showing Ratio|Diff|QPE >= 50%|-0.00|1.00"';}	
			// console.log("LABEL: " + LABEL);
			$("#label2").html(LABEL);
			BasinRatioFilterVALUE = FILTERVALUE;
			if (BasinPlotSourcealt == 'TopPerformer'){BasinPlotSource = BasinPlotSourcealt};
			GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);
			};
		};

		//Slider Bar to Filter Above Basin Plots
		$(function() {
			$( "#slider2" ).slider({
			value:0,
			min: 0,
			max: 50,
			step: 5,
			slide: function( event2, ui2 ) {
			//console.log("FILTERVALUE: " + ui2.value);
			FILTERVALUE = ui2.value;
			if (FILTERVALUE == 0.0){BasinDiffFilterVALUE = -2.50;BasinqpeFilterVALUE = 0.00;LABEL = 'Showing Ratio|Diff|QPE >= 1%|-2.50|0.01"';}
			if (FILTERVALUE == 5.0){BasinDiffFilterVALUE = -2.25;BasinqpeFilterVALUE = 0.10;LABEL = 'Showing Ratio|Diff|QPE >= 5%|-2.25|0.10"';}
			if (FILTERVALUE == 10.0){BasinDiffFilterVALUE = -2.00;BasinqpeFilterVALUE = 0.20;LABEL = 'Showing Ratio|Diff|QPE >= 10%|-2.00|0.20"';}
			if (FILTERVALUE == 15.0){BasinDiffFilterVALUE = -1.75;BasinqpeFilterVALUE = 0.30;LABEL = 'Showing Ratio|Diff|QPE >= 15%|-1.75|0.30"';}
			if (FILTERVALUE == 20.0){BasinDiffFilterVALUE = -1.50;BasinqpeFilterVALUE = 0.40;LABEL = 'Showing Ratio|Diff|QPE >= 20%|-1.50|0.40"';}
			if (FILTERVALUE == 25.0){BasinDiffFilterVALUE = -1.25;BasinqpeFilterVALUE = 0.50;LABEL = 'Showing Ratio|Diff|QPE >= 25%|-1.25|0.50"';}
			if (FILTERVALUE == 30.0){BasinDiffFilterVALUE = -1.00;BasinqpeFilterVALUE = 0.60;LABEL = 'Showing Ratio|Diff|QPE >= 30%|-1.00|0.60"';}
			if (FILTERVALUE == 35.0){BasinDiffFilterVALUE = -0.75;BasinqpeFilterVALUE = 0.70;LABEL = 'Showing Ratio|Diff|QPE >= 35%|-0.75|0.70"';}
			if (FILTERVALUE == 40.0){BasinDiffFilterVALUE = -0.50;BasinqpeFilterVALUE = 0.80;LABEL = 'Showing Ratio|Diff|QPE >= 40%|-0.50|0.80"';}
			if (FILTERVALUE == 45.0){BasinDiffFilterVALUE = -0.25;BasinqpeFilterVALUE = 0.90;LABEL = 'Showing Ratio|Diff|QPE >= 45%|-0.25|0.90"';}
			if (FILTERVALUE == 50.0){BasinDiffFilterVALUE = -0.00;BasinqpeFilterVALUE = 1.00;LABEL = 'Showing Ratio|Diff|QPE >= 50%|-0.00|1.00"';}	
			// console.log("LABEL: " + LABEL);
			$("#label2").html(LABEL);
			BasinRatioFilterVALUE = FILTERVALUE;
			GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);
				}
			});
		});		

		var AutoFilterTrigger = true;
		function changeAutoFilterTrigger(){
			var Filterbox = document.getElementById("AutoFilter");
			if (Filterbox.checked == true){AutoFilterTrigger = true;};
			if (Filterbox.checked == false){AutoFilterTrigger = false;};
		};

		// //Update Layer Visibility Function
		var box;
		function updateLayerVisibility(layer,object) {
			layersplit = layer.split("-");
			layername = layersplit[0];
			mapid = layersplit[1];
			templayername = layername + mapid;
			box = document.getElementById(templayername);
			var inputCount = object.length;
			for (var i = 0; i < inputCount; i++) {
				objectalt = object[i];
				if (box.checked == true) {
				objectalt.show();
				// console.log("Show: " + layername + " On Map" + mapid);
				} else {
				objectalt.hide();
				// console.log("Hide: " + layername + " On Map" + mapid);
				};
			};
		};		

		function changeMap(slayer) {
		selectedlayer = slayer;
		clearCSVLayers();
		//console.log("SELECTED: " + selectedlayer);
		var box1 = document.getElementById("Precip1");
		var box2 = document.getElementById("Precip2");
		if (box1.checked == true && box2.checked == true){
			if (selectedlayer === "30min") {csv30min1.show();csv30mintextLayer1.show();csv30min2.show();csv30mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			if (selectedlayer === "60min") {csv60min1.show();csv60mintextLayer1.show();csv60min2.show();csv60mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			if (selectedlayer === "120min") {csv120min1.show();csv120mintextLayer1.show();csv120min2.show();csv120mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			if (selectedlayer === "180min") {csv180min1.show();csv180mintextLayer1.show();csv180min2.show();csv180mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			if (selectedlayer === "360min") {csv360min1.show();csv360mintextLayer1.show();csv360min2.show();csv360mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			if (selectedlayer === "720min") {csv720min1.show();csv720mintextLayer1.show();csv720min2.show();csv720mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			if (selectedlayer === "1440min") {csv1440min1.show();csv1440mintextLayer1.show();csv1440min2.show();csv1440mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			if (selectedlayer === "1441min") {csv1441min1.show();csv1441mintextLayer1.show();csv1441min2.show();csv1441mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
			} else {
				if (box1.checked == false && box2.checked == false){
				if (selectedlayer === "30min") {GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
				if (selectedlayer === "60min") {GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
				if (selectedlayer === "120min") {GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
				if (selectedlayer === "180min") {GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
				if (selectedlayer === "360min") {GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
				if (selectedlayer === "720min") {GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
				if (selectedlayer === "1440min") {GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
				if (selectedlayer === "1441min") {GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};			
				} else {			
					if (box1.checked == true) {
						if (selectedlayer === "30min") {csv30min1.show();csv30mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "60min") {csv60min1.show();csv60mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "120min") {csv120min1.show();csv120mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "180min") {csv180min1.show();csv180mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "360min") {csv360min1.show();csv360mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "720min") {csv720min1.show();csv720mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "1440min") {csv1440min1.show();csv1440mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "1441min") {csv1441min1.show();csv1441mintextLayer1.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						};
					if (box2.checked == true) {
						if (selectedlayer === "30min") {csv30min2.show();csv30mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "60min") {csv60min2.show();csv60mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "120min") {csv120min2.show();csv120mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "180min") {csv180min2.show();csv180mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "360min") {csv360min2.show();csv360mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "720min") {csv720min2.show();csv720mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "1440min") {csv1440min2.show();csv1440mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						if (selectedlayer === "1441min") {csv1441min2.show();csv1441mintextLayer2.show();GetTopPerformer(selectedlayer,BasinPlotType,"MRMS",BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);};
						};
					};
				};
		};
	
		function clearCSVLayers(){csv30min1.hide();csv30mintextLayer1.hide();csv60min1.hide();csv60mintextLayer1.hide();csv120min1.hide();csv120mintextLayer1.hide();csv180min1.hide();csv180mintextLayer1.hide();csv360min1.hide();
			csv360mintextLayer1.hide();csv720min1.hide();csv720mintextLayer1.hide();csv1440min1.hide();csv1440mintextLayer1.hide();csv1441min1.hide();csv1441mintextLayer1.hide();csv30min2.hide();csv30mintextLayer2.hide();
			csv60min2.hide();csv60mintextLayer2.hide();csv120min2.hide();csv120mintextLayer2.hide();csv180min2.hide();csv180mintextLayer2.hide();csv360min2.hide();csv360mintextLayer2.hide();csv720min2.hide();csv720mintextLayer2.hide();
			csv1440min2.hide();csv1440mintextLayer2.hide();csv1441min2.hide();csv1441mintextLayer2.hide();};
			
		function changePrimaryLegend(layerdivid,imgName,LegendId){
				//console.log("IMAGE NAME: " + imgName);
				var layerbox = document.getElementById(layerdivid);
				if (LegendId === 'PrimaryLegend1'){Map1PrimaryLegend = imgName};
				if (LegendId === 'PrimaryLegend2'){Map2PrimaryLegend = imgName};
				if (imgName != "") {
				if (layerbox.checked == true) {
					document.getElementById(LegendId).innerHTML="<img src='" + MainDir + "images/legends/"+imgName+".png'/>";
					document.getElementById(LegendId).style.visibility= 'visible';
				} else {
					document.getElementById(LegendId).style.visibility= 'hidden';};	
				};
			};
				
		function changeSecondaryLegend(layerdivid,imgName,LegendId){
				//console.log("IMAGE NAME: " + imgName);
				var layerbox = document.getElementById(layerdivid);
				if (LegendId === 'SecondaryLegend1'){Map1SecondaryLegend = imgName};
				if (LegendId === 'SecondaryLegend2'){Map2SecondaryLegend = imgName};
				if (imgName != "") {
				if (layerbox.checked == true) {
					document.getElementById(LegendId).innerHTML="<img src='" + MainDir + "images/legends/"+imgName+".png'/>";
					document.getElementById(LegendId).style.visibility= 'visible';
				} else {
					document.getElementById(LegendId).style.visibility= 'hidden';};	
				};
			};
				
		function UpdateValidTime(VT){
		$("#ValidTime").html("Last Updated: " + VT + "Z");
		return VT;
		};		
		
		//Read in PrecipAnalysisStats csv file to check for new data and redraw ONLY if necessary
		var OldValidTimeLine; 
		function CheckandUpdate(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE){
		$.get(DataDir + "PrecipAnalysisStats.csv", function( txt ) {
				var data = txt.split('\r\n');
				ValidTimeLine = data[0];
				OldVT = UpdateValidTime(ValidTimeLine);
				//console.log(ValidTimeLine + ' is Valid Time');
				//console.log(OldValidTimeLine + ' is Last Valid Time OUT');
				if (ValidTimeLine != OldValidTimeLine){
				GetTopPerformer(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE);
				document.getElementById("RiverTable1").innerHTML = "";
				document.getElementById("RiverTable2").innerHTML = "";
				BuildRiverTable();
				OldValidTimeLine = OldVT;
				console.log("New Data Found");
				} else {
				console.log("No New Data Found")
				};
				
		});
		};
		
		//Button lists and Buttons
		//Set Startup Buttons, Layers, and checkboxes
		document.getElementById(startupqpesource).style.backgroundColor = "yellow";
		var BasinPlotSource = startupqpesource;
		document.getElementById(Keys[0]).style.backgroundColor = "yellow";
		document.getElementById('60min').style.backgroundColor = "yellow";
		document.getElementById("Precip1").checked = true;
		document.getElementById("QPESOURCE1").checked = true;
		document.getElementById("Basins2").checked = true;
		document.getElementById("LSR1").checked = true;
		document.getElementById("AutoFilter").checked = true;
		document.getElementById("Ratio").style.backgroundColor = "yellow";
		var activeprecip1 = '60min';
		var activeprecip2 = '60min';
		var selectedlayer = '60min';
		var BasinPlotType = 'Ratio';
		var Map1PrimaryLegend = 'Ratio';
		var Map2PrimaryLegend = 'Ratio';
		var Map1SecondaryLegend = 'precipitation';
		var Map2SecondaryLegend = '';
		var BasinRatioFilterVALUE = 0.00;
		var BasinDiffFilterVALUE = -2.50;
		var BasinqpeFilterVALUE = 0.01;
		updateLayerVisibility("QPESOURCE-1",[mil1]);
		updateLayerVisibility("Basins-2",[SubBasins2]);
		csv60min1.show();
		csv60mintextLayer1.show();		
		changePrimaryLegend("Precip1",Map1PrimaryLegend,"PrimaryLegend1");
		changePrimaryLegend("Basins2",Map2PrimaryLegend,"PrimaryLegend2");
		changeSecondaryLegend("QPESOURCE1",Map1SecondaryLegend,"SecondaryLegend1");
		changeSecondaryLegend("QPESOURCE2",Map2SecondaryLegend,"SecondaryLegend2");
		// changeMap(activeprecip1);
		// changeMap(activeprecip2);
		
		//Auto Refresh Certain Layers Every 10 Seconds
		setInterval(function(){CheckandUpdate(selectedlayer,BasinPlotType,BasinPlotSource,BasinRatioFilterVALUE,BasinDiffFilterVALUE,BasinqpeFilterVALUE)}, 10000);
		
		//Auto Refresh Spot Forecast Layer Every 1 Minutes
		setInterval(function(){GenerateSPOTS();}, 60000);
	
		});
	});
	
	
	//JS for Tabs
	function LoadTab1(evt, TabName) {
    // Declare all variables
    var i, tabcontent1, tablinks1;

    // Get all elements with class="tabcontent" and hide them
    tabcontent1 = document.getElementsByClassName("tabcontent1");
    for (i = 0; i < tabcontent1.length; i++) {
        tabcontent1[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks1 = document.getElementsByClassName("tablinks1");
    for (i = 0; i < tablinks1.length; i++) {
        tablinks1[i].className = tablinks1[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the link that opened the tab
    document.getElementById(TabName).style.display = "block";
    evt.currentTarget.className += " active";
	//console.log("EVENT=" + evt);
	}	
	
	function LoadTab2(evt, TabName) {
    // Declare all variables
    var i, tabcontent2, tablinks2;

    // Get all elements with class="tabcontent" and hide them
    tabcontent2 = document.getElementsByClassName("tabcontent2");
    for (i = 0; i < tabcontent2.length; i++) {
        tabcontent2[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks2 = document.getElementsByClassName("tablinks2");
    for (i = 0; i < tablinks2.length; i++) {
        tablinks2[i].className = tablinks2[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the link that opened the tab
    document.getElementById(TabName).style.display = "block";
    evt.currentTarget.className += " active";
	//console.log("EVENT=" + evt);
	}	
	

	
	</script>	
		
		
	</head>

	<body>
		<div id="topcontainer">		
		<div id="precipinterval">
		<h3>Precipitation Plot Controls</h3>
		<div id="label" style="padding-bottom:4px;font-weight:bold;font-size:12px;color:#99FFFF;padding-top:3px;">Showing Precip Obs > 0.00"</div>
		<div id="slider"></div>
		<br>
		<button id="30min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 30M</button>
		<button id="60min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 1HR</button>
		<button id="120min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 2HR</button>
		<button id="180min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 3HR</button>
		<button id="360min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 6HR</button>
		<button id="720min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 12HR</button>
		<button id="1440min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 24HR</button>
		<button id="1441min" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> 12z-12z</button>
		<br>
		<div id="ValidTime" style="position:relative;padding-bottom:0px;font-weight:bold;font-size:18px;color:#99FFFF;"></div>
		</div>
		
		<div id="maplayers">
		<h3>Map Layers</h3>
		<div id="columnone">
		<div id='Precip-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Precip1' value='Precip' /></div>
		<div id='Precip-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Precip2' value='Precip' />Precip Obs</div><br>
		<div id='Basins-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Basins1' value='Basins' /></div>
		<div id='Basins-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Basins2' value='Basins' />Basins</div><br>
		<div id='Rivers-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Rivers1' value='LatestRiverStages1' /></div>
		<div id='Rivers-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Rivers2' value='LatestRiverStages2' />Rivers</div><br>
		<div id='LatestTemperatures-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LatestTemperatures1' value='LatestTemperatures1' /></div>
		<div id='LatestTemperatures-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LatestTemperatures2' value='LatestTemperatures2' />Temps</div><br>
		<div id='LatestWindGusts-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LatestWindGusts1' value='LatestWindGusts1' /></div>
		<div id='LatestWindGusts-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LatestWindGusts2' value='LatestWindGusts2' />Winds</div><br>
		<div id='LatestWindChill-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LatestWindChill1' value='LatestWindChill1' /></div>
		<div id='LatestWindChill-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LatestWindChill2' value='LatestWindChill2' />WindChill</div><br>
		</div>
		<div id="columntwo">
		<div id='QPESOURCE-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='QPESOURCE1' value='QPESOURCE1' /></div>
		<div id='QPESOURCE-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='QPESOURCE2' value='QPESOURCE2' />QPE Image</div><br>
		<div id='Radar-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Radar1' value='Radar_DMSLayer1' /></div>
		<div id='Radar-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Radar2' value='Radar_DMSLayer2' />Radar</div><br>
		<div id='Warnings-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Warnings1' value='Warnings_DMSLayer1' /></div>
		<div id='Warnings-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Warnings2' value='Warnings_DMSLayer2' />Warnings</div><br>
		<div id='Watches-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Watches1' value='Watches_DMSLayer1' /></div>
		<div id='Watches-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Watches2' value='Watches_DMSLayer2' />Watches</div><br>
		<div id='Roads-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Roads1' value='Roads_DMSLayer1' /></div>
		<div id='Roads-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Roads2' value='Roads_DMSLayer2' />Highways</div><br>
		<div id='NWSCWAs-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='NWSCWAs1' value='NWSCWAs1' /></div>
		<div id='NWSCWAs-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='NWSCWAs2' value='NWSCWAs2' />NWS CWA's</div><br>
		</div>
		<div id="columnthree">
		<div id='Spotters-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Spotters1' value='Spotters' /></div>
		<div id='Spotters-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='Spotters2' value='Spotters' />Spotters</div><br>
		<div id='fire-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='fire1' value='fire' /></div>
		<div id='fire-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='fire2' value='fire' />Fire</div><br>
		<div id='police-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='police1' value='police' /></div>
		<div id='police-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='police2' value='police' />Police</div><br>
		<div id='postoffice-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='postoffice1' value='postoffice' /></div>
		<div id='postoffice-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='postoffice2' value='postoffice' />Post</div><br>
		<div id='schools-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='schools1' value='schools' /></div>
		<div id='schools-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='schools2' value='schools' />Schools</div><br>
		<div id='OtherContacts-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='OtherContacts1' value='OtherContacts' /></div>
		<div id='OtherContacts-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='OtherContacts2' value='OtherContacts' />Others</div><br>
		</div>
		
		<div id="columnfour">
		<div id='LSR-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LSR1' value='LSR1' /></div>
		<div id='LSR-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='LSR2' value='LSR2' />LSR's</div><br>
		<div id='SpotForecast-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='SpotForecast1' value='SpotForecast' /></div>
		<div id='SpotForecast-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='SpotForecast2' value='SpotForecast' />Spot Fcsts</div><br>
		<div id='RainObs-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='RainObs1' value='RainObs1' /></div>
		<div id='RainObs-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='RainObs2' value='RainObs2' />Ob Sites</div><br>
		<div id='FloodEvents-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='FloodEvents1' value='FloodEvents1' /></div>
		<div id='FloodEvents-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='FloodEvents2' value='FloodEvents2' />Floods</div><br>
		<div id='NCLandSlides-1' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='NCLandSlides1' value='NCLandSlides1' /></div>
		<div id='NCLandSlides-2' class='boxes' style='display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;'><input type='checkbox' class='list_item' id='NCLandSlides2' value='NCLandSlides2' />NC Slides</div><br>
		</div>
		</div>
		
		<div id="geolocate">
		<h3>Geo-Locator</h3>
		<input type="text" style="width:90%;height:20px;border:1px solid #3300FF;border-radius:5px;" id="address">
		<input type="text" style="width:40%;height:20px;border:1px solid #3300FF;border-radius:5px;" id="lat">
		<input type="text" style="width:40%;height:20px;border:1px solid #3300FF;border-radius:5px;" id="lon">
		<br>
		<br>
		<button id="locate" style="border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;margin-bottom:5px;">Locate</button>
		<button id="clearlocate" style="border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;margin-bottom:5px;">Clear</button>
		</div>
		
		<div id="basinsettings">
		<h3>Basin Plot Controls</h3>
		<div id ="basinsboxescolumn">
		<!-- <button id="FFG" style="display:inline;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;">FFG</button> -->
		<button id="QPE" style="display:inline;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;">QPE</button>
		<button id="Ratio" style="display:inline;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;">Ratio</button>
		<button id="Diff" style="display:inline;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;">Diff</button>
		<div id='AutoFilter-1' class='boxes' style='position:absolute;display:inline-block;font-weight:bold;font-size:12px;color:#99FFFF;right:1%;top:15%'><input type='checkbox' class='list_item' id='AutoFilter' value='AutoFilter' />AutoFilter</div>
		</div>
		<div id="label2" style="padding-bottom:6px;padding-top:6px;font-weight:bold;font-size:12px;color:#99FFFF;">Showing Ratio|Diff|QPE >= 1%|-2.50|0.01"</div>
		<div id="slider2"></div>
		<br>	
		<button id="DPR" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> DualPol</button>
		<button id="DHR" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> Legacy</button>
		<button id="HPE" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> HPE</button>
		<button id="BHPE" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> BIASHPE</button>
		<button id="MRMS" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> MRMS</button>
		<br>
		<button id="TopPerformer" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> TopPerf</button>
		<button id="WorstCase" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> WorstCase</button>
		<button id="BestCase" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> BestCase</button>
		<button id="AllBlend" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> AllBlend</button>
		<button id="SmartBlend" style="position:relative;border:1px solid #3300FF;border-radius:5px;margin:1px;background:#99FFFF;bottom:5px;"> SmartBlend</button>
		</div>
		
		</div>
		
		<div id="mapcontrols">	
		</div>
		
		<div id="tabscontainer">
		<ul class="tab1">
		<li><a href="javascript:void(0)" class="tablinks1 active" onclick="LoadTab1(event, 'MapContent1')">Map</a></li>
		<li><a href="javascript:void(0)" class="tablinks1" onclick="LoadTab1(event, 'BasinTable1')">Basin Table</a></li>
		<li><a href="javascript:void(0)" class="tablinks1" onclick="LoadTab1(event, 'RiverTable1')">Stream Table</a></li>
		<li><a href="javascript:void(0)" class="tablinks1" onclick="LoadTab1(event, 'SitAware1')">NWSChat</a></li>
		</ul>
		
		<ul class="tab2">
		<li><a href="javascript:void(0)" class="tablinks2 active" onclick="LoadTab2(event, 'MapContent2')">Map</a></li>
		<li><a href="javascript:void(0)" class="tablinks2" onclick="LoadTab2(event, 'BasinTable2')">Basin Table</a></li>
		<li><a href="javascript:void(0)" class="tablinks2" onclick="LoadTab2(event, 'RiverTable2')">Stream Table</a></li>
		<li><a href="javascript:void(0)" class="tablinks2" onclick="LoadTab2(event, 'SitAware2')">NWSChat</a></li>
		</ul>
		</div>

		<div id="mapscontainer">

			<!-- Map1 area -->

			<div id="MapContent1" class="tabcontent1">
				<!-- Map -->
				<div id="map1" style="height:100%;">
				<div id="LatLon1" style="position:absolute;font-weight: bold; font-size:14px; left:1px; bottom:4px; color:#000; z-index:100; width:105px; padding:5px;background: rgba(255, 255, 255, 1.0);border:1px solid black;border-radius:3px;"></div>
				<div id="PrimaryLegend1" style="position:absolute;left:-3px;bottom:30px;z-index:50;margin: 0 auto;"><img src="" alt=""></div>
				<div id="SecondaryLegend1" style="position:absolute;left:1px;top:5px;z-index:50;"><img src="" alt=""></div>
				<!-- <div id="RatioLegend" style="position:absolute; left:10px; bottom:40px; z-index:50; padding:5px;"><img src="" alt=""></div> -->
				<div id="BasemapToggle1"></div>
				</div>
			</div>	
			
			<div id="BasinTable1" class="tabcontent1" style="display:none;"></div>
			<div id="RiverTable1" class="tabcontent1" style="display:none;"></div>
			<div id="SitAware1" class="tabcontent1" style="display:none;"><object type="text/html" data="https://nwschat.weather.gov/live/?nomap" width="100%" height="100%"></object></div>

			<!-- Map2 area -->
			
			<div id="MapContent2" class="tabcontent2">
				<!-- Map -->
				<div id="map2" style="height:100%;">
				<div id="LatLon2" style="position:absolute;font-weight: bold; font-size:14px; left:1px; bottom:4px; color:#000; z-index:100; width:105px; padding:5px;background: rgba(255, 255, 255, 1.0);border:1px solid black;border-radius:3px;"></div>
				<div id="PrimaryLegend2" style="position:absolute;left:-3px;bottom:30px;z-index:50;margin: 0 auto;"><img src="" alt=""></div>
				<div id="SecondaryLegend2" style="position:absolute;left:1px;top:5px;z-index:50;"><img src="" alt=""></div>
				<!-- <div id="RatioLegend" style="position:absolute; left:10px; bottom:40px; z-index:50; padding:5px;"><img src="" alt=""></div> -->
				<div id="BasemapToggle2"></div>
				</div>
			</div>	
			
			<div id="BasinTable2" class="tabcontent2" style="display:none;"></div>
			<div id="RiverTable2" class="tabcontent2" style="display:none;"></div>
			<div id="SitAware2" class="tabcontent2" style="display:none;"><object type="text/html" data="https://nwschat.weather.gov/live/?nomap" width="100%" height="100%"></object></div>
   
		</div>


	</body>	
</html>
